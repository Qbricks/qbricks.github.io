<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<link rel="stylesheet" href="style.css" type="text/css">
<title>tutorial_solution.html</title>
</head>
<body>
<p>why3doc index <a href="index.html">index</a></p>
<hr>
<div class="why3doc">
<h1>Solution</h1>
<p>This file provides solutions for both tutorial exercises.</p>
<pre><span class="keyword">module</span> <a name="GHZ_">GHZ</a>
<span class="keyword">use</span> int.<a href="int.html#Int_">Int</a>
<span class="keyword">use</span> ref.<a href="ref.html#Ref_">Ref</a>

<span class="keyword">use</span> tool_box.Tool_box_Real

<span class="keyword">let</span> <span class="keyword">constant</span> <a name="hadamard_33">hadamard</a> : <a href="tool_box.html#circuit_32">circuit</a>
  = <a href="tool_box.html#hadamard_204">hadamard</a>
      <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = 1}
      <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = 1}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 0 = y 0}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.  <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  = (x 0 <a href="int.html#infix%20*_20">*</a>y 0)<a href="tool_box.html#infix%20/./_123">/./</a>1 }

<span class="keyword">let</span> <span class="keyword">function</span> <a name="place_hadamard_40">place_hadamard</a>   (k n:int)  : <a href="tool_box.html#circuit_32">circuit</a>
      <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a>n}
      <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = 1}
      <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = n}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. 0<a href="int.html#infix%20%3C=_25">&lt;=</a>i<a href="int.html#infix%20%3C_21">&lt;</a>n -&gt; <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y i = <span class="keyword">if</span> i = k <span class="keyword">then</span> y 0 <span class="keyword">else</span> x i}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.  <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  =  (x k <a href="int.html#infix%20*_20">*</a> y 0) <a href="tool_box.html#infix%20/./_123">/./</a> 1}
      = <a href="tool_box.html#place_223">place</a> <a href="#hadamard_33">hadamard</a>  k n

<span class="keyword">let</span> <span class="keyword">constant</span> <a name="place_hadamard_b_48">place_hadamard_b</a>  : <a href="tool_box.html#circuit_32">circuit</a>
      = <a href="#place_hadamard_40">place_hadamard</a>  0 2
      <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = 1}
      <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = 2}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 0 =  y 0 }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 1 =  x 1 }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.  <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  =  (x 0 <a href="int.html#infix%20*_20">*</a> y 0) <a href="tool_box.html#infix%20/./_123">/./</a> 1}

<span class="keyword">let</span> <span class="keyword">constant</span> <a name="cnot_b_56">cnot_b</a> : <a href="tool_box.html#circuit_32">circuit</a>
= <a href="tool_box.html#cnot_245">cnot</a> 0 1 2
      <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = 0}
      <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = 2}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y : int-&gt;int.  <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 0 =  x 0}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y : int-&gt;int. <a href="tool_box.html#binary_l_69">binary_l</a> x 2 -&gt; <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 1 = <a href="tool_box.html#xor_104">xor</a>  (x 0) (x 1) }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span>  x y.<a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  =  <a href="tool_box.html#ang_zero_120">ang_zero</a>}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> d: <a href="tool_box.html#circuit_32">circuit</a>. <span class="keyword">forall</span>  x y.
 	 	<a href="tool_box.html#width_194">width</a> d = 2 -&gt; <a href="tool_box.html#basis_ket_192">basis_ket</a> (d <a href="tool_box.html#infix%20--_234">--</a> result) x y 0 =  <a href="tool_box.html#basis_ket_192">basis_ket</a> d x y 0}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> d: <a href="tool_box.html#circuit_32">circuit</a>. <span class="keyword">forall</span>  x y.
	 	<a href="tool_box.html#binary_l_69">binary_l</a> x 2 -&gt;<a href="tool_box.html#binary_l_69">binary_l</a> y (<a href="tool_box.html#range_191">range</a> d) -&gt;  <a href="tool_box.html#width_194">width</a> d = 2 -&gt;
			 <a href="tool_box.html#basis_ket_192">basis_ket</a> (d <a href="tool_box.html#infix%20--_234">--</a>result) x y 1 = <a href="tool_box.html#xor_104">xor</a>  (<a href="tool_box.html#basis_ket_192">basis_ket</a> d x y 0) ( <a href="tool_box.html#basis_ket_192">basis_ket</a> d x y 1) }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> d: <a href="tool_box.html#circuit_32">circuit</a>. <span class="keyword">forall</span>  x y.
	 	<a href="tool_box.html#width_194">width</a> d = 2 -&gt;  <a href="tool_box.html#ang_ind_193">ang_ind</a> (d<a href="tool_box.html#infix%20--_234">--</a>result) x y  = <a href="tool_box.html#ang_ind_193">ang_ind</a> d x y}

<span class="keyword">let</span> <span class="keyword">constant</span> <a name="bell_71">bell</a>
=  <a href="#place_hadamard_b_48">place_hadamard_b</a> <a href="tool_box.html#infix%20--_234">--</a> <a href="#cnot_b_56">cnot_b</a>
       <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = 2}
       <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = 1}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y.  <a href="tool_box.html#binary_l_69">binary_l</a> x 2 -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 0 =y 0  }
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y.  <a href="tool_box.html#binary_l_69">binary_l</a> x 2 -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
       		<a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 1 = <a href="tool_box.html#xor_104">xor</a> (y 0) (x 1)}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y
                   = (y 0 <a href="int.html#infix%20*_20">*</a> x 0) <a href="tool_box.html#infix%20/./_123">/./</a> 1}

<span class="keyword">let</span> <span class="keyword">constant</span> <a name="bell_size_three_82">bell_size_three</a>
= <a href="tool_box.html#place_223">place</a> <a href="#bell_71">bell</a> 0 3
      <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = 3}
      <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = 1}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y.  <a href="tool_box.html#binary_l_69">binary_l</a> x 3 -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 0 =y 0  }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y.  <a href="tool_box.html#binary_l_69">binary_l</a> x 3 -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 1 = <a href="tool_box.html#xor_104">xor</a> (y 0) (x 1)}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y.  <a href="tool_box.html#binary_l_69">binary_l</a> x 3 -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 2 = x 2}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y
                   = (y 0 <a href="int.html#infix%20*_20">*</a> x 0) <a href="tool_box.html#infix%20/./_123">/./</a> 1}

<span class="keyword">let</span> <span class="keyword">constant</span> <a name="ghz3_95">ghz3</a>
=  <a href="#bell_size_three_82">bell_size_three</a>  <a href="tool_box.html#infix%20--_234">--</a> <a href="tool_box.html#cnot_245">cnot</a> 0 2 3
      <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = 3}
      <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = 1}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y.  <a href="tool_box.html#binary_l_69">binary_l</a> x 3 -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 0 =y 0  }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y i. 1<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> 3 -&gt;  <a href="tool_box.html#binary_l_69">binary_l</a> x 3 -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y i =  <a href="tool_box.html#xor_104">xor</a> (y 0) (x i) }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y
                   = (y 0 <a href="int.html#infix%20*_20">*</a> x 0) <a href="tool_box.html#infix%20/./_123">/./</a> 1}

<span class="keyword">let</span> <span class="keyword">rec</span> <a name="ghz_rec_106">ghz_rec</a>(n:int)
      <span class="keyword">requires</span>{2<a href="int.html#infix%20%3C=_25">&lt;=</a>n}
      <span class="keyword">variant</span>{n}
      <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = n}
      <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = 1}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y.  <a href="tool_box.html#binary_l_69">binary_l</a> x n -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 0 =y 0  }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y i. 1<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> n -&gt;  <a href="tool_box.html#binary_l_69">binary_l</a> x n -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y i = <a href="tool_box.html#xor_104">xor</a> (y 0) (x i)  }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y
                   = (y 0 <a href="int.html#infix%20*_20">*</a> x 0) <a href="tool_box.html#infix%20/./_123">/./</a> 1}
		   = <span class="keyword">if</span> n <a href="int.html#infix%20=_16">=</a> 2 <span class="keyword">then</span> <a href="#bell_71">bell</a>
		   <span class="keyword">else</span> <a href="tool_box.html#place_223">place</a> (ghz_rec (n<a href="int.html#infix%20-_23">-</a>1)) 0 n <a href="tool_box.html#infix%20--_234">--</a> <a href="tool_box.html#cnot_245">cnot</a> 0 (n<a href="int.html#infix%20-_23">-</a>1) n

<span class="keyword">let</span> <a name="ghz_120">ghz</a>(n:int)
<span class="keyword">requires</span>{1<a href="int.html#infix%20%3C_21">&lt;</a>n}
      <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = n}
      <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = 1}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y.  <a href="tool_box.html#binary_l_69">binary_l</a> x n -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y 0 =y 0  }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y i. 1<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> n -&gt;  <a href="tool_box.html#binary_l_69">binary_l</a> x n -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y 1 -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y i = <a href="tool_box.html#xor_104">xor</a> (y 0) (x i)  }
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y
                   = (y 0 <a href="int.html#infix%20*_20">*</a> x 0) <a href="tool_box.html#infix%20/./_123">/./</a> 1}
= <span class="keyword">let</span> cnot_reg = ref (<a href="tool_box.html#m_skip_214">m_skip</a> n  )
  <span class="keyword">in</span> <span class="keyword">for</span> q = 1 <span class="keyword">to</span> n<a href="int.html#infix%20-_23">-</a>1 <span class="keyword">do</span>
      <span class="keyword">invariant</span>{<a href="tool_box.html#width_194">width</a> <a href="ref.html#prefix%20!_18">!</a>cnot_reg = n}
      <span class="keyword">invariant</span>{<a href="tool_box.html#range_191">range</a> <a href="ref.html#prefix%20!_18">!</a>cnot_reg = 0}
      <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y.  <a href="tool_box.html#binary_l_69">binary_l</a> x n -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> <a href="ref.html#prefix%20!_18">!</a>cnot_reg x y 0 =x 0  }
      <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y i.  q<a href="int.html#infix%20%3C=_25">&lt;=</a>i -&gt;  <a href="tool_box.html#binary_l_69">binary_l</a> x n -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> <a href="ref.html#prefix%20!_18">!</a>cnot_reg x y i = x i }
      <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y i. 1<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> q -&gt;  <a href="tool_box.html#binary_l_69">binary_l</a> x n -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> <a href="ref.html#prefix%20!_18">!</a>cnot_reg x y i = <a href="tool_box.html#xor_104">xor</a>  (x 0)  (x i) }
      <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> <a href="ref.html#prefix%20!_18">!</a>cnot_reg x y
                   = <a href="tool_box.html#ang_zero_120">ang_zero</a>}
		   cnot_reg <a href="ref.html#infix%20:=_20">:=</a> <a href="ref.html#prefix%20!_18">!</a>cnot_reg <a href="tool_box.html#infix%20--_234">--</a> <a href="tool_box.html#cnot_245">cnot</a> 0 q n
		   <span class="keyword">done</span>;
      <span class="keyword">assert</span>{<a href="tool_box.html#range_191">range</a> <a href="ref.html#prefix%20!_18">!</a>cnot_reg = 0};
 <a href="#place_hadamard_40">place_hadamard</a> 0 n <a href="tool_box.html#infix%20--_234">--</a> <a href="ref.html#prefix%20!_18">!</a>cnot_reg
<span class="keyword">end</span>

<span class="keyword">module</span> <a name="Qft_">Qft</a>

<span class="keyword">use</span> int.<a href="int.html#Int_">Int</a>
<span class="keyword">use</span> ref.<a href="ref.html#Ref_">Ref</a>
<span class="keyword">use</span> tool_box.<a href="tool_box.html#Tool_box_Intf_">Tool_box_Intf</a>

<span class="keyword">let</span> <a name="qft_155">qft</a> ( n:int) :<a href="tool_box.html#circuit_32">circuit</a>
      <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C_21">&lt;</a>n}  =
      <span class="keyword">let</span> <span class="keyword">function</span> qft_inner_phase   (x y :int -&gt; int)  (q l  :int)
      =  x l <a href="int.html#infix%20*_20">*</a> y q  <a href="int.html#infix%20*_20">*</a> <a href="tool_box.html#power_34">power</a> 2 (n<a href="int.html#infix%20-_23">-</a> l  <a href="int.html#infix%20-_23">-</a>1 <a href="int.html#infix%20+_19">+</a>q) <a href="tool_box.html#infix%20/./_123">/./</a>n
      	    <span class="keyword">in</span>  <span class="keyword">let</span> <span class="keyword">function</span> phase_sum_cont    (x :int -&gt; int) (q l:int)
     	     <span class="keyword">ensures</span>{result =  qft_inner_phase x x  q l}
	     = x l <a href="int.html#infix%20*_20">*</a> x q <a href="int.html#infix%20*_20">*</a> <a href="tool_box.html#power_34">power</a> 2 (n<a href="int.html#infix%20-_23">-</a>l<a href="int.html#infix%20-_23">-</a>1<a href="int.html#infix%20+_19">+</a>q) <a href="tool_box.html#infix%20/./_123">/./</a>n
      <span class="keyword">in</span>
      <span class="keyword">begin</span>
      <span class="keyword">let</span> c = ref (<a href="tool_box.html#m_skip_214">m_skip</a> n)
      <span class="keyword">in</span> <span class="keyword">for</span> q = 0 <span class="keyword">to</span> n<a href="int.html#infix%20-_23">-</a>1 <span class="keyword">do</span>
            <span class="keyword">invariant</span>{<a href="tool_box.html#width_194">width</a> <a href="ref.html#prefix%20!_18">!</a>c = n}
      	    <span class="keyword">invariant</span>{<a href="tool_box.html#range_191">range</a> <a href="ref.html#prefix%20!_18">!</a>c = q}
      	    <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y i. 0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> n -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> <a href="ref.html#prefix%20!_18">!</a>c x y i = <span class="keyword">if</span> 0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> q <span class="keyword">then</span> y i <span class="keyword">else</span> x i}
      	    <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> <a href="ref.html#prefix%20!_18">!</a>c x y
                   = <a href="tool_box.html#ang_sum_154">ang_sum</a>(<span class="keyword">fun</span> k -&gt; <a href="tool_box.html#ang_sum_154">ang_sum</a> (<span class="keyword">fun</span> l -&gt; qft_inner_phase x y k l ) k n)0 q}
         <span class="keyword">begin</span>
           <span class="keyword">let</span> cl = ref (<a href="tool_box.html#rm_skip_385">rm_skip</a> n)
           <span class="keyword">in</span> <span class="keyword">for</span> i = q<a href="int.html#infix%20+_19">+</a>1 <span class="keyword">to</span> n<a href="int.html#infix%20-_23">-</a>1 <span class="keyword">do</span>
                  <span class="keyword">invariant</span>{<a href="tool_box.html#width_194">width</a> <a href="ref.html#prefix%20!_18">!</a>cl = n}
             	  <span class="keyword">invariant</span>{<a href="tool_box.html#diag_circ_279">diag_circ</a>  <a href="ref.html#prefix%20!_18">!</a>cl}
             	  <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> <a href="ref.html#prefix%20!_18">!</a>cl x y
                          = <a href="tool_box.html#ang_sum_154">ang_sum</a> (phase_sum_cont x q) (q<a href="int.html#infix%20+_19">+</a>1) i}
		  <span class="keyword">let</span>  new_rot = (<a href="tool_box.html#crz_320">crz</a> i (q) (i <a href="int.html#infix%20-_23">-</a> q<a href="int.html#infix%20+_19">+</a>1) n )
		      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y = phase_sum_cont  x q i}
		  <span class="keyword">in</span>
		  <a href="tool_box.html#ang_sum_comp_re_diag_409">ang_sum_comp_re_diag</a> (phase_sum_cont) <a href="ref.html#prefix%20!_18">!</a>cl new_rot q (q<a href="int.html#infix%20+_19">+</a>1) i;
                  cl <a href="ref.html#infix%20:=_20">:=</a> <a href="tool_box.html#seq_diag_287">seq_diag</a> <a href="ref.html#prefix%20!_18">!</a>cl  new_rot;
		  <span class="keyword">done</span>;
	<span class="keyword">let</span> place_had = <a href="tool_box.html#place_hadamard_394">place_hadamard</a> (q) n
	    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y = qft_inner_phase x (<span class="keyword">fun</span> j -&gt; y (j<a href="int.html#infix%20-_23">-</a>q)) q q }
	<span class="keyword">in</span>
	 <a href="tool_box.html#ang_sum_comp_plus_one_427">ang_sum_comp_plus_one</a> (<span class="keyword">fun</span>  x y k-&gt; qft_inner_phase x (<span class="keyword">fun</span> j -&gt; y (j<a href="int.html#infix%20-_23">-</a>q)) k)  place_had <a href="ref.html#prefix%20!_18">!</a>cl q q n;
           cl<a href="ref.html#infix%20:=_20">:=</a>  <a href="tool_box.html#seq_diag_right_298">seq_diag_right</a> place_had  <a href="ref.html#prefix%20!_18">!</a>cl;
	   <span class="keyword">assert</span>{<span class="keyword">forall</span> x y i. 0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> n -&gt;
                     <a href="tool_box.html#basis_ket_192">basis_ket</a> <a href="ref.html#prefix%20!_18">!</a>cl x y i = <span class="keyword">if</span> i = q <span class="keyword">then</span> y 0 <span class="keyword">else</span> x i};
             <span class="keyword">assert</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> <a href="ref.html#prefix%20!_18">!</a>cl x y =
                       <a href="tool_box.html#ang_sum_154">ang_sum</a> (qft_inner_phase x (<span class="keyword">fun</span> j -&gt; y (j<a href="int.html#infix%20-_23">-</a>q)) q  )
		       q n};
              c<a href="ref.html#infix%20:=_20">:=</a> <a href="ref.html#prefix%20!_18">!</a>c <a href="tool_box.html#infix%20--_234">--</a> <a href="ref.html#prefix%20!_18">!</a>cl;
     <span class="keyword">end</span>
    <span class="keyword">done</span>;
    <a href="tool_box.html#phase_binary_prod_decomp_436">phase_binary_prod_decomp</a> n;
    <span class="keyword">return</span> (<a href="ref.html#prefix%20!_18">!</a>c)
     <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = n}
     <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = n}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y i. 0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> n -&gt; <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y i = y i}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  = <a href="tool_box.html#ang_sum_154">ang_sum</a>(<span class="keyword">fun</span> k -&gt;
             <a href="tool_box.html#ang_sum_154">ang_sum</a> (<span class="keyword">fun</span> l -&gt; qft_inner_phase x y k l ) k n) 0 n}
   <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  = (<a href="tool_box.html#ind_isum_38">ind_isum</a>(<span class="keyword">fun</span> k -&gt;
             (<a href="tool_box.html#ind_isum_38">ind_isum</a> (<span class="keyword">fun</span> l -&gt; x l <a href="int.html#infix%20*_20">*</a> y k <a href="int.html#infix%20*_20">*</a> <a href="tool_box.html#power_34">power</a> 2 (n<a href="int.html#infix%20-_23">-</a>l <a href="int.html#infix%20-_23">-</a> 1<a href="int.html#infix%20+_19">+</a>k)) k n))0 n) <a href="tool_box.html#infix%20/./_123">/./</a> n}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#binary_l_69">binary_l</a> x n -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y n -&gt; <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  =
             (<a href="tool_box.html#bv_to_int_99">bv_to_int</a> (<a href="tool_box.html#make_bv_87">make_bv</a> x n) <a href="int.html#infix%20*_20">*</a> <a href="tool_box.html#bv_to_int_99">bv_to_int</a> (<a href="tool_box.html#bv_inversion_95">bv_inversion</a> (<a href="tool_box.html#make_bv_87">make_bv</a> y n))) <a href="tool_box.html#infix%20/./_123">/./</a>n}
  <span class="keyword">end</span>

<span class="keyword">let</span> <a name="qft_sol_211">qft_sol</a> ( n:int) :<a href="tool_box.html#circuit_32">circuit</a>
      <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C_21">&lt;</a>n}  =
      <span class="keyword">let</span> <span class="keyword">function</span> qft_inner_phase   (x y :int -&gt; int)  (q l  :int)
      =  x l <a href="int.html#infix%20*_20">*</a> y q  <a href="int.html#infix%20*_20">*</a> <a href="tool_box.html#power_34">power</a> 2 (n<a href="int.html#infix%20-_23">-</a> l  <a href="int.html#infix%20-_23">-</a>1 <a href="int.html#infix%20+_19">+</a>q) <a href="tool_box.html#infix%20/./_123">/./</a>n
      	    <span class="keyword">in</span>  <span class="keyword">let</span> <span class="keyword">function</span> phase_sum_cont    (x :int -&gt; int) (q l:int)
     	     <span class="keyword">ensures</span>{result =  qft_inner_phase x x  q l}
	     = x l <a href="int.html#infix%20*_20">*</a> x q <a href="int.html#infix%20*_20">*</a> <a href="tool_box.html#power_34">power</a> 2 (n<a href="int.html#infix%20-_23">-</a>l<a href="int.html#infix%20-_23">-</a>1<a href="int.html#infix%20+_19">+</a>q) <a href="tool_box.html#infix%20/./_123">/./</a>n
      <span class="keyword">in</span>
      <span class="keyword">begin</span>
      <span class="keyword">let</span> c = ref (<a href="tool_box.html#m_skip_214">m_skip</a> n)
      <span class="keyword">in</span> <span class="keyword">for</span> q = 0 <span class="keyword">to</span> n<a href="int.html#infix%20-_23">-</a>1 <span class="keyword">do</span>
            <span class="keyword">invariant</span>{<a href="tool_box.html#width_194">width</a> <a href="ref.html#prefix%20!_18">!</a>c = n}
      	    <span class="keyword">invariant</span>{<a href="tool_box.html#range_191">range</a> <a href="ref.html#prefix%20!_18">!</a>c = q}
      	    <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y i. 0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> n -&gt;
                   <a href="tool_box.html#basis_ket_192">basis_ket</a> <a href="ref.html#prefix%20!_18">!</a>c x y i = <span class="keyword">if</span> 0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> q <span class="keyword">then</span> y i <span class="keyword">else</span> x i}
      	    <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> <a href="ref.html#prefix%20!_18">!</a>c x y
                   = <a href="tool_box.html#ang_sum_154">ang_sum</a>(<span class="keyword">fun</span> k -&gt; <a href="tool_box.html#ang_sum_154">ang_sum</a> (<span class="keyword">fun</span> l -&gt; qft_inner_phase x y k l ) k n)0 q}
         <span class="keyword">begin</span>
           <span class="keyword">let</span> cl = ref (<a href="tool_box.html#rm_skip_385">rm_skip</a> n)
           <span class="keyword">in</span> <span class="keyword">for</span> i = q<a href="int.html#infix%20+_19">+</a>1 <span class="keyword">to</span> n<a href="int.html#infix%20-_23">-</a>1 <span class="keyword">do</span>
                  <span class="keyword">invariant</span>{<a href="tool_box.html#width_194">width</a> <a href="ref.html#prefix%20!_18">!</a>cl = n}
             	  <span class="keyword">invariant</span>{<a href="tool_box.html#diag_circ_279">diag_circ</a>  <a href="ref.html#prefix%20!_18">!</a>cl}
             	  <span class="keyword">invariant</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> <a href="ref.html#prefix%20!_18">!</a>cl x y
                          = <a href="tool_box.html#ang_sum_154">ang_sum</a> (phase_sum_cont x q) (q<a href="int.html#infix%20+_19">+</a>1) i}
		  <span class="keyword">let</span>  new_rot = (<a href="tool_box.html#crz_320">crz</a> i (q) (i <a href="int.html#infix%20-_23">-</a> q<a href="int.html#infix%20+_19">+</a>1) n )
		      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y = phase_sum_cont  x q i}
		  <span class="keyword">in</span>
		  <a href="tool_box.html#ang_sum_comp_re_diag_409">ang_sum_comp_re_diag</a> (phase_sum_cont) <a href="ref.html#prefix%20!_18">!</a>cl new_rot q (q<a href="int.html#infix%20+_19">+</a>1) i;
                  cl <a href="ref.html#infix%20:=_20">:=</a> <a href="tool_box.html#seq_diag_287">seq_diag</a> <a href="ref.html#prefix%20!_18">!</a>cl  new_rot;
		  <span class="keyword">done</span>;
	<span class="keyword">let</span> place_had = <a href="tool_box.html#place_hadamard_394">place_hadamard</a> (q) n
	    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y = qft_inner_phase x (<span class="keyword">fun</span> j -&gt; y (j<a href="int.html#infix%20-_23">-</a>q)) q q }
	<span class="keyword">in</span>
	 <a href="tool_box.html#ang_sum_comp_plus_one_427">ang_sum_comp_plus_one</a> (<span class="keyword">fun</span>  x y k-&gt; qft_inner_phase x (<span class="keyword">fun</span> j -&gt; y (j<a href="int.html#infix%20-_23">-</a>q)) k)  place_had <a href="ref.html#prefix%20!_18">!</a>cl q q n;
           cl<a href="ref.html#infix%20:=_20">:=</a>  <a href="tool_box.html#seq_diag_right_298">seq_diag_right</a> place_had  <a href="ref.html#prefix%20!_18">!</a>cl;
	   <span class="keyword">assert</span>{<span class="keyword">forall</span> x y i. 0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> n -&gt;
                     <a href="tool_box.html#basis_ket_192">basis_ket</a> <a href="ref.html#prefix%20!_18">!</a>cl x y i = <span class="keyword">if</span> i = q <span class="keyword">then</span> y 0 <span class="keyword">else</span> x i};
             <span class="keyword">assert</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> <a href="ref.html#prefix%20!_18">!</a>cl x y =
                       <a href="tool_box.html#ang_sum_154">ang_sum</a> (qft_inner_phase x (<span class="keyword">fun</span> j -&gt; y (j<a href="int.html#infix%20-_23">-</a>q)) q  )
		       q n};
              c<a href="ref.html#infix%20:=_20">:=</a> <a href="ref.html#prefix%20!_18">!</a>c <a href="tool_box.html#infix%20--_234">--</a> <a href="ref.html#prefix%20!_18">!</a>cl;
     <span class="keyword">end</span>
    <span class="keyword">done</span>;
    <a href="tool_box.html#phase_binary_prod_decomp_436">phase_binary_prod_decomp</a> n;
    <span class="keyword">return</span> (<a href="ref.html#prefix%20!_18">!</a>c)
     <span class="keyword">ensures</span>{<a href="tool_box.html#width_194">width</a> result = n}
     <span class="keyword">ensures</span>{<a href="tool_box.html#range_191">range</a> result = n}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y i. 0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> n -&gt; <a href="tool_box.html#basis_ket_192">basis_ket</a> result x y i = y i}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  = <a href="tool_box.html#ang_sum_154">ang_sum</a>(<span class="keyword">fun</span> k -&gt;
             <a href="tool_box.html#ang_sum_154">ang_sum</a> (<span class="keyword">fun</span> l -&gt; qft_inner_phase x y k l ) k n) 0 n}
   <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  = (<a href="tool_box.html#ind_isum_38">ind_isum</a>(<span class="keyword">fun</span> k -&gt;
             (<a href="tool_box.html#ind_isum_38">ind_isum</a> (<span class="keyword">fun</span> l -&gt; x l <a href="int.html#infix%20*_20">*</a> y k <a href="int.html#infix%20*_20">*</a> <a href="tool_box.html#power_34">power</a> 2 (n<a href="int.html#infix%20-_23">-</a>l <a href="int.html#infix%20-_23">-</a> 1<a href="int.html#infix%20+_19">+</a>k)) k n))0 n) <a href="tool_box.html#infix%20/./_123">/./</a> n}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="tool_box.html#binary_l_69">binary_l</a> x n -&gt; <a href="tool_box.html#binary_l_69">binary_l</a> y n -&gt; <a href="tool_box.html#ang_ind_193">ang_ind</a> result x y  =
             (<a href="tool_box.html#bv_to_int_99">bv_to_int</a> (<a href="tool_box.html#make_bv_87">make_bv</a> x n) <a href="int.html#infix%20*_20">*</a> <a href="tool_box.html#bv_to_int_99">bv_to_int</a> (<a href="tool_box.html#bv_inversion_95">bv_inversion</a> (<a href="tool_box.html#make_bv_87">make_bv</a> y n))) <a href="tool_box.html#infix%20/./_123">/./</a>n}
  <span class="keyword">end</span>

<span class="comment">(* let qft ( n:int) :circuit *)</span>
<span class="comment">(*       requires{0&lt;n}  = *)</span>
<span class="comment">(*   begin *)</span>
<span class="comment">(*     let c = ref (m_skip n) *)</span>
<span class="comment">(*     in for q = 0 to n-1 do *)</span>
<span class="comment">(*             invariant{width !c = n} *)</span>
<span class="comment">(*       	    invariant{range !c = q} *)</span>
<span class="comment">(*       	    invariant{forall x y i. 0&lt;= i &lt; n -&gt; *)</span>
<span class="comment">(*                    basis_ket !c x y i = if 0&lt;= i &lt; q then y i else x i} *)</span>
<span class="comment">(*       	    invariant{forall x y. ang_ind !c x y *)</span>
<span class="comment">(*                    = (ind_isum(fun k -&gt; (ind_isum (fun l -&gt; x l * y k * power 2 (n-l - 1+k)) k n))0 q) /./ n} *)</span>
<span class="comment">(*             invariant{size !c &lt;=q*( cont_size *  n +1)} *)</span>
<span class="comment">(*          begin *)</span>
<span class="comment">(*            let cl = ref (m_skip n) *)</span>
<span class="comment">(*            in for i = q+1 to n-1 do *)</span>
<span class="comment">(*                   invariant{width !cl = n} *)</span>
<span class="comment">(*              	  invariant{range !cl = 0} *)</span>
<span class="comment">(*              	  invariant{forall x y i. 0&lt;= i &lt; n -&gt; *)</span>
<span class="comment">(*                           basis_ket !cl x y i = x i} *)</span>
<span class="comment">(*              	  invariant{forall x y. ang_ind !cl x y *)</span>
<span class="comment">(*                           =(ind_isum (fun l -&gt; x l * x q * power 2 (n- l -1+ q)) (q+1) i) /./n} *)</span>
<span class="comment">(*              	  invariant{size !cl &lt;= cont_size *  (i-q-1) } *)</span>
<span class="comment">(*                 cl := !cl -- (crz i (q) (i - q+1) n );    *)</span>
<span class="comment">(*           done; *)</span>
<span class="comment">(*            cl:=  place_hadamard (q) n -- !cl; *)</span>
<span class="comment">(*              assert{forall x y i. 0&lt;= i &lt; n -&gt; *)</span>
<span class="comment">(*                      basis_ket !cl x y i = if i = q then y 0 else x i}; *)</span>
<span class="comment">(*              assert{forall x y. ang_ind !cl x y = *)</span>
<span class="comment">(*                        (ind_isum (fun l -&gt; x l * y 0 * power 2 (n-l - 1+ q)) q n) /./ n}; *)</span>
<span class="comment">(*              assert{size !cl &lt;= cont_size *  (n-q-1) +1}; *)</span>
<span class="comment">(*               c:= !c -- !cl; *)</span>
<span class="comment">(*      end *)</span>
<span class="comment">(*     done;   *)</span>
<span class="comment">(*     phase_binary_prod_decomp n; *)</span>
<span class="comment">(*     return (!c) *)</span>
<span class="comment">(*      ensures{width result = n} *)</span>
<span class="comment">(*      ensures{range result = n} *)</span>
<span class="comment">(*      ensures{forall x y i. 0&lt;= i &lt; n -&gt; basis_ket result x y i = y i} *)</span>
<span class="comment">(*      ensures{forall x y. ang_ind result x y  = (ind_isum(fun k -&gt; *)</span>
<span class="comment">(*              (ind_isum (fun l -&gt; x l * y k * power 2 (n-l - 1+k)) k n))0 n) /./ n}           *)</span>
<span class="comment">(*      ensures{forall x y. binary_l x n -&gt; binary_l y n -&gt; ang_ind result x y  =   *)</span>
<span class="comment">(*              (bv_to_int (make_bv x n) * bv_to_int (bv_inversion (make_bv y n))) /./n} *)</span>
<span class="comment">(*      ensures{size !c &lt;=n* (n* cont_size  +1)} *)</span>
<span class="comment">(*   end *)</span>

<span class="keyword">end</span>

</pre>

</div>
<hr>
<p>Generated by why3doc 1.8.0</p>
</body>
</html>
