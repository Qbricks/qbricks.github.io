<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<link rel="stylesheet" href="style.css" type="text/css">
<title>tool_box.html</title>
</head>
<body>
<p>why3doc index <a href="index.html">index</a></p>
<hr>
<div class="why3doc">
<h1>Tool box</h1>
<p>This file provides a minimal toolbox of object and spec constructs, together with lemmas at use for adressing the exercise in file tuto.mlw. Functions and lemmas below are simple extraction from Qbricks library.</p>
<pre><span class="keyword">module</span> <a name="Tool_box_Intf_">Tool_box_Intf</a>
</pre>
<div class="info"><p>This module is an interface, providing all the specifications at use for another module calling its realization. Note that is does not contain any dependency, so as to limitate the local context to the minimum required when using the library.</p>
</div><pre><span class="keyword">use</span> int.<a href="int.html#Int_">Int</a>

<span class="keyword">type</span> <a name="circuit_32">circuit</a>
<span class="keyword">val</span>  <span class="keyword">function</span> <a name="power_33">power</a> (e i:int)  : int

<span class="keyword">val</span>   <span class="keyword">function</span> <a name="ind_isum_36">ind_isum</a>  (f :int -&gt; int) (i:int) (j:int):int
</pre>
<div class="info"><p>&quot;ind_isum&quot; is a big integer addition operator, summing integers (f k) for k varying from i to j.</p>
</div><pre><span class="keyword">val</span>  <span class="keyword">lemma</span> <a name="ind_isum_eq_39">ind_isum_eq</a> (f g : int -&gt; int) (i i1 j j1:int)
       <span class="keyword">requires</span>{<span class="keyword">forall</span> k : int. i <a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> j -&gt; f k = g k}
       <span class="keyword">requires</span>{i = i1}
       <span class="keyword">requires</span>{j = j1}
       <span class="keyword">ensures</span>{ <a href="#ind_isum_36">ind_isum</a>  f i j = <a href="#ind_isum_36">ind_isum</a>   g i1 j1}
</pre>
<div class="info"><p>term to term equality in sums</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ind_isum_empty_47">ind_isum_empty</a> (f :int -&gt; int) (i:int) (j:int)
       <span class="keyword">requires</span>{j <a href="int.html#infix%20%3C=_25">&lt;=</a> i}
       <span class="keyword">ensures</span>{ <a href="#ind_isum_36">ind_isum</a>  f i j =  0}
</pre>
<div class="info"><p>empty sum of integer</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ind_isum_re_52">ind_isum_re</a> (f :int -&gt; int) (i:int) (j:int)
       <span class="keyword">requires</span>{i <a href="int.html#infix%20%3C_21">&lt;</a> j}
       <span class="keyword">ensures</span>{<a href="#ind_isum_36">ind_isum</a> f i j = <a href="#ind_isum_36">ind_isum</a> f i (j<a href="int.html#infix%20-_23">-</a>1) <a href="int.html#infix%20+_19">+</a> f (j<a href="int.html#infix%20-_23">-</a>1)}
</pre>
<div class="info"><p>integer sum right extension</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ind_isum_plus_one_57">ind_isum_plus_one</a> (f :int -&gt; int) (i:int) (j:int)
       <span class="keyword">requires</span>{i <a href="int.html#infix%20%3C_21">&lt;</a> j}
       <span class="keyword">ensures</span>{ <a href="#ind_isum_36">ind_isum</a>  f i j =  (f i) <a href="int.html#infix%20+_19">+</a> ( <a href="#ind_isum_36">ind_isum</a>  f (i<a href="int.html#infix%20+_19">+</a>1) j)}
</pre>
<div class="info"><p>integer sum left extension</p>
</div><h2>Bit vectors </h2>
<pre><span class="keyword">type</span> <a name="bitvec_64">bitvec</a>

<span class="keyword">predicate</span> <a name="binary_l_67">binary_l</a> (x: int-&gt; int)( n :int)
</pre>
<div class="info"><p>An integer function is &quot;binary_l n&quot; (&#39;binary up to n&#39;) iff it sends any  k st 0&lt;=k&lt;n to either &quot;0&quot; or &quot;1&quot;.</p>
</div><pre><span class="keyword">axiom</span> <a name="binary_def'lemma_69">binary_def</a>: <span class="keyword">forall</span> x n. <a href="#binary_l_67">binary_l</a> x n &lt;-&gt; (<span class="keyword">forall</span> k. 0<a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> n -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a> x k<a href="int.html#infix%20%3C_21">&lt;</a>2)

<span class="keyword">val</span> <span class="keyword">lemma</span> <a name="binary_prefix_73">binary_prefix</a> (x: int-&gt; int)( n n&#39;:int)
       <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>n&#39;<a href="int.html#infix%20%3C=_25">&lt;=</a>n}
       <span class="keyword">requires</span>{<a href="#binary_l_67">binary_l</a> x n}
       <span class="keyword">ensures</span>{<a href="#binary_l_67">binary_l</a> x n&#39;}
</pre>
<div class="info"><p>The &quot;binary_l&quot; property is stable by prefixing.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="binary_init_79">binary_init</a> (x: int-&gt; int)( n :int)
       <span class="keyword">requires</span>{n =0}
       <span class="keyword">ensures</span>{<a href="#binary_l_67">binary_l</a> x n}
</pre>
<div class="info"><p>Any function is 0-binary_l.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="make_bv_85">make_bv</a> (f:int-&gt;int) (s:int): (<a href="#bitvec_64">bitvec</a>)
       <span class="keyword">requires</span>{<a href="#binary_l_67">binary_l</a> f s}
       <span class="keyword">requires</span>{s<a href="int.html#infix%20%3E=_26">&gt;=</a>0}
</pre>
<div class="info"><p>&quot;make_bv&quot; builds a bit vector of size s from an integer function that is binary up to &quot;s&quot;.</p>
</div><pre><span class="keyword">val</span>  <span class="keyword">function</span> <a name="bv_inversion_90">bv_inversion</a> (bv:<a href="#bitvec_64">bitvec</a>):<a href="#bitvec_64">bitvec</a>
</pre>
<div class="info"><p>&quot;bv_inversion&quot; reverses a bit vector</p>
</div><pre><span class="keyword">val</span>  <span class="keyword">function</span> <a name="bv_to_int_93">bv_to_int</a> (_: <a href="#bitvec_64">bitvec</a>): int
       <span class="keyword">ensures</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> result}
</pre>
<div class="info"><p>Casting function from bit vector to integer.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="xor_97">xor</a> (a b :int):int
       <span class="keyword">ensures</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>a<a href="int.html#infix%20%3C_21">&lt;</a>2 -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a> b <a href="int.html#infix%20%3C_21">&lt;</a> 2 -&gt; result = a <a href="int.html#infix%20*_20">*</a>(1<a href="int.html#infix%20-_23">-</a>b) <a href="int.html#infix%20+_19">+</a> b <a href="int.html#infix%20*_20">*</a>(1<a href="int.html#infix%20-_23">-</a>a)}
</pre>
<div class="info"><p>boolean style naming for modulo 2 addition</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="xor_eq_101">xor_eq</a> (a b a&#39; b&#39;:int)
       <span class="keyword">requires</span>{a=a&#39;}
       <span class="keyword">requires</span>{b=b&#39;}
       <span class="keyword">ensures</span>{<a href="#xor_97">xor</a> a  b= <a href="#xor_97">xor</a> a&#39;  b&#39;}
</pre>
<div class="info"><p>xor identity</p>
</div><h2>Angle type description</h2>
<p>In Qbricks, phase parameters are described in a dedicated &#39;angle&#39; type, described in math_lib/unit_circle/Angle.</p>
<pre><span class="keyword">type</span> <a name="angle_110">angle</a>

<span class="keyword">val</span> <span class="keyword">constant</span>  <a name="ang_zero_113">ang_zero</a>: <a href="#angle_110">angle</a>
</pre>
<div class="info"><p>the angle of measure 0 is named &quot;ang_zero&quot;</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> (<a name="infix%20/./_116">/./</a>) (k:int) (n:int) :<a href="#angle_110">angle</a>
</pre>
<div class="info"><p>Given two integer parameters k and n, one can build the angle &quot;k /./ n&quot;, of measure 2pi(k/2^n).</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> (<a name="infix%20+.+_119">+.+</a>) (k:<a href="#angle_110">angle</a>) (n:<a href="#angle_110">angle</a>) :<a href="#angle_110">angle</a>
</pre>
<div class="info"><p>Angle addition: declaration.</p>
</div><pre><span class="keyword">axiom</span> <a name="ang_null'lemma_122">ang_null</a> : <span class="keyword">forall</span> k. k <a href="#infix%20/./_116">/./</a>0 = <a href="#ang_zero_113">ang_zero</a>

<span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ang_add_eq_125">ang_add_eq</a> (d1 d2 e1 e2:<a href="#angle_110">angle</a>)
       <span class="keyword">requires</span>{d1 = e1}
       <span class="keyword">requires</span>{d2 = e2}
       <span class="keyword">ensures</span>{d1 <a href="#infix%20+.+_119">+.+</a> d2 = e1 <a href="#infix%20+.+_119">+.+</a> e2}
</pre>
<div class="info"><p>Function &quot;+.+&quot; represent an angle addition</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="int_to_ang_add_rev_131">int_to_ang_add_rev</a> (i j n:int)
       <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> n}
       <span class="keyword">ensures</span>{(i <a href="int.html#infix%20+_19">+</a> j) <a href="#infix%20/./_116">/./</a> n =  (i <a href="#infix%20/./_116">/./</a> n)<a href="#infix%20+.+_119">+.+</a> (j <a href="#infix%20/./_116">/./</a> n) }
</pre>
<div class="info"><p>Addition decomposition for constructor /./.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="int_to_ang_eq_136">int_to_ang_eq</a> (k1 k2 n1 n2: int)
        <span class="keyword">requires</span>{k1=k2}
        <span class="keyword">requires</span>{n1=n2}
        <span class="keyword">ensures</span>{k1 <a href="#infix%20/./_116">/./</a> n1 = k2 <a href="#infix%20/./_116">/./</a> n2}
</pre>
<div class="info"><p>Equality accross &quot;/./&quot;</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ang_add_zero_142">ang_add_zero</a> (d&#39; d:<a href="#angle_110">angle</a>)
        <span class="keyword">requires</span>{d&#39; = <a href="#ang_zero_113">ang_zero</a>}
        <span class="keyword">ensures</span>{d <a href="#infix%20+.+_119">+.+</a>  d&#39; = d}
</pre>
<div class="info"><p>&quot;ang_zero&quot; is neutral for angle addition</p>
</div><pre><span class="keyword">val</span>  <span class="keyword">function</span> <a name="ang_sum_147">ang_sum</a> (f : int -&gt; <a href="#angle_110">angle</a>) (i j:int):<a href="#angle_110">angle</a>
</pre>
<div class="info"><p>big angle addition operator: declaration</p>
</div><pre><span class="keyword">val</span>  <span class="keyword">lemma</span> <a name="ang_sum_re_150">ang_sum_re</a>  (f : int -&gt; <a href="#angle_110">angle</a>) (i j : int)
          <span class="keyword">requires</span>{i <a href="int.html#infix%20+_19">+</a>1 <a href="int.html#infix%20%3C=_25">&lt;=</a> j }
          <span class="keyword">ensures</span>  { (<a href="#ang_sum_147">ang_sum</a> f i j) =  ( (<a href="#ang_sum_147">ang_sum</a> f i (j<a href="int.html#infix%20-_23">-</a>1)) <a href="#infix%20+.+_119">+.+</a> (f (j<a href="int.html#infix%20-_23">-</a>1))) }
</pre>
<div class="info"><p>big angle addition operator: right extension</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ang_sum_plus_one_155">ang_sum_plus_one</a> (f :int -&gt; <a href="#angle_110">angle</a>) (i:int) (j:int)
      <span class="keyword">requires</span>{i<a href="int.html#infix%20%3C_21">&lt;</a> j}
      <span class="keyword">ensures</span>{ <a href="#ang_sum_147">ang_sum</a> f i j =  (f i)<a href="#infix%20+.+_119">+.+</a>(<a href="#ang_sum_147">ang_sum</a> f (i<a href="int.html#infix%20+_19">+</a>1) j)}
</pre>
<div class="info"><p>big angle addition operator: left extension</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ang_sum_eq_160">ang_sum_eq</a>  (f g : int -&gt; <a href="#angle_110">angle</a>) (i j i&#39; j&#39;:int)
      <span class="keyword">requires</span>{i <a href="int.html#infix%20%3C=_25">&lt;=</a> j}
      <span class="keyword">requires</span>{i = i&#39;}
      <span class="keyword">requires</span>{j = j&#39;}
      <span class="keyword">requires</span>{<span class="keyword">forall</span> k : int. i <a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> j -&gt; f k = g k}
      <span class="keyword">ensures</span>{ <a href="#ang_sum_147">ang_sum</a>  f i j = <a href="#ang_sum_147">ang_sum</a>  g i&#39; j&#39;}
</pre>
<div class="info"><p>big angle addition operator: equality</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ang_sum_empty_168">ang_sum_empty</a> (f :int -&gt; <a href="#angle_110">angle</a>) (i:int) (j:int)
       <span class="keyword">requires</span>{j = i}
       <span class="keyword">ensures</span>{<a href="#ang_sum_147">ang_sum</a>  f i j =  <a href="#ang_zero_113">ang_zero</a>}
</pre>
<div class="info"><p>empty sum of angles</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ang_sum_to_ind_isum_173">ang_sum_to_ind_isum</a> (f: int-&gt; <a href="#angle_110">angle</a>) ( g: int-&gt; int) (n i j:int)
          <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>n}
          <span class="keyword">requires</span>{i <a href="int.html#infix%20%3C_21">&lt;</a> j}
	  <span class="keyword">requires</span>{<span class="keyword">forall</span> k. i<a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> j-&gt; f k = (g k) <a href="#infix%20/./_116">/./</a> n}
          <span class="keyword">ensures</span>{<a href="#ang_sum_147">ang_sum</a> f i j = (<a href="#ind_isum_36">ind_isum</a> g i j) <a href="#infix%20/./_116">/./</a> n}
</pre>
<div class="info"><p>sum of angles to sum of integers</p>
</div><h2>Quantum circuits constructors</h2>
<p>Here we provide some basic circuit constructors, sufficient for approximating any unitary operation with arbitrary precision (approximately universal set of gates). Each circuit is specified with parameters sufficient for building a path sum (its &quot;width&quot; -- the number of qubits it adresses; its &quot;range&quot; -- the base 2 logarithm of the number of path, its &quot;basis_ket&quot; function -- the standard basis vector handling each path; its &quot;ang_ind&quot; term -- the phase polynomial, of type angle). Note that, in addition, the specifications below hold a &#39;size&#39; parameter -- specifying a &#39;weighted&#39; gate count  enabling parametrized resource estimation. The implementation reffered to here holds a case study weight function: any elementary gate has weight 1 and a controlled Z rotation has weight &#39;cont_size&#39;, a non-instanciated integer parameter.</p>
<pre> <span class="keyword">function</span> <a name="range_184">range</a> : <a href="#circuit_32">circuit</a> -&gt;int
 <span class="keyword">function</span> <a name="basis_ket_185">basis_ket</a> : <a href="#circuit_32">circuit</a> -&gt; (int-&gt;int) -&gt; (int-&gt;int) -&gt; int-&gt;int
 <span class="keyword">function</span> <a name="ang_ind_186">ang_ind</a> : <a href="#circuit_32">circuit</a> -&gt; (int-&gt;int) -&gt; (int-&gt;int) -&gt; <a href="#angle_110">angle</a>
 <span class="keyword">function</span> <a name="width_187">width</a> : <a href="#circuit_32">circuit</a> -&gt;int
</pre>
<div class="info"><p>Path-sum components declaration.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="binary_basis_ket_190">binary_basis_ket</a> (d:<a href="#circuit_32">circuit</a>)  (x y:int-&gt;int) (n :int)
        <span class="keyword">requires</span>{<a href="#width_187">width</a> d = n}
        <span class="keyword">requires</span>{<a href="#binary_l_67">binary_l</a> x n}
        <span class="keyword">requires</span>{<a href="#binary_l_67">binary_l</a> y (<a href="#range_184">range</a> d)}
        <span class="keyword">ensures</span>{<a href="#binary_l_67">binary_l</a> (<a href="#basis_ket_185">basis_ket</a> d x y ) n}
</pre>
<div class="info"><p>As a generic quantum circuit invariant, the &quot;basis_ket&quot; function preserves binaricity up to the width of the circuit at stake.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">constant</span> <a name="hadamard_197">hadamard</a> : <a href="#circuit_32">circuit</a>
</pre>
<div class="info"><p>Constructor for the Hadamard constant</p>
</div><pre><span class="keyword">axiom</span> <a name="range_had'lemma_201">range_had</a>:<a href="#range_184">range</a> <a href="#hadamard_197">hadamard</a> = 1
<span class="keyword">axiom</span> <a name="width_had'lemma_202">width_had</a> : <a href="#width_187">width</a> <a href="#hadamard_197">hadamard</a> = 1
<span class="keyword">axiom</span> <a name="basis_ket_had'lemma_203">basis_ket_had</a>: <span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="#basis_ket_185">basis_ket</a> <a href="#hadamard_197">hadamard</a> x y i = y i
<span class="keyword">axiom</span> <a name="ang_ind_had'lemma_204">ang_ind_had</a>:<span class="keyword">forall</span> x y: int-&gt;int.  <a href="#ang_ind_186">ang_ind</a> <a href="#hadamard_197">hadamard</a> x y  = (x 0 <a href="int.html#infix%20*_20">*</a>y 0)<a href="#infix%20/./_116">/./</a>1
</pre>
<div class="info"><p>Hadamard constant path-sum axioms</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="m_skip_207">m_skip</a> (k:int): <a href="#circuit_32">circuit</a>
        <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C_21">&lt;</a>k}
        <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = 0}
        <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = k}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i. <a href="#basis_ket_185">basis_ket</a> result x y i = x i}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="#ang_ind_186">ang_ind</a> result x y  =  1 <a href="#infix%20/./_116">/./</a> 0}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> k:int. <a href="#ang_ind_186">ang_ind</a> result x y  =  0 <a href="#infix%20/./_116">/./</a> k}
</pre>
<div class="info"><p>Constructor for a &#39;skip&#39; (empty) circuit of variable width, potentially useful for initializing loops.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="place_216">place</a> (c:<a href="#circuit_32">circuit</a>) (k n :int):<a href="#circuit_32">circuit</a>
        <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>k}
        <span class="keyword">requires</span>{ <a href="#width_187">width</a> c<a href="int.html#infix%20+_19">+</a> k <a href="int.html#infix%20%3C=_25">&lt;=</a>n}
        <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = n}
        <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = <a href="#range_184">range</a> c}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. k<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> k <a href="int.html#infix%20+_19">+</a> <a href="#width_187">width</a> c -&gt;  <a href="#basis_ket_185">basis_ket</a> result x y i =  <a href="#basis_ket_185">basis_ket</a> c (<span class="keyword">fun</span> j -&gt; x (j<a href="int.html#infix%20+_19">+</a>k)) y (i<a href="int.html#infix%20-_23">-</a>k)}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. i <a href="int.html#infix%20%3C_21">&lt;</a> k -&gt;  <a href="#basis_ket_185">basis_ket</a> result x y i = x i}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. k <a href="int.html#infix%20+_19">+</a><a href="#width_187">width</a> c <a href="int.html#infix%20%3C=_25">&lt;=</a> i -&gt; <a href="#basis_ket_185">basis_ket</a> result x y i =  x i}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="#ang_ind_186">ang_ind</a> result x y  = <a href="#ang_ind_186">ang_ind</a> c (<span class="keyword">fun</span> j -&gt; x (j<a href="int.html#infix%20+_19">+</a>k)) y}
</pre>
<div class="info"><p>Constructor for gate/subcircuit application.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> (<a name="infix%20--_227">--</a>) ( d e:<a href="#circuit_32">circuit</a>) :<a href="#circuit_32">circuit</a>
        <span class="keyword">requires</span>{<a href="#width_187">width</a> d = <a href="#width_187">width</a> e}
        <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = <a href="#width_187">width</a> d}
        <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = <a href="#range_184">range</a> d <a href="int.html#infix%20+_19">+</a> <a href="#range_184">range</a> e}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int.
		       <a href="#basis_ket_185">basis_ket</a> result x y i =
		       <a href="#basis_ket_185">basis_ket</a> e (<a href="#basis_ket_185">basis_ket</a> d x y) (<span class="keyword">fun</span> k -&gt; y (k<a href="int.html#infix%20+_19">+</a> <a href="#range_184">range</a> d)) i}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="#ang_ind_186">ang_ind</a> result x y  =
                       (<a href="#ang_ind_186">ang_ind</a> d x y) <a href="#infix%20+.+_119">+.+</a> (<a href="#ang_ind_186">ang_ind</a> e (<a href="#basis_ket_185">basis_ket</a> d x y)  (<span class="keyword">fun</span> k -&gt; y (k<a href="int.html#infix%20+_19">+</a> <a href="#range_184">range</a> d)))}
</pre>
<div class="info"><p>Sequencing</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="cnot_238">cnot</a> (co t n:int) : <a href="#circuit_32">circuit</a>
         <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> co<a href="int.html#infix%20%3C_21">&lt;</a>n}
         <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> t<a href="int.html#infix%20%3C_21">&lt;</a>n}
         <span class="keyword">requires</span>{t&lt;&gt;co}
         <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = 0}
         <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = n}
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y : int-&gt;int. <span class="keyword">forall</span> i: int.
	 	i &lt;&gt; t -&gt;<a href="#basis_ket_185">basis_ket</a> result x y i =  x i}
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y : int-&gt;int. <span class="keyword">forall</span> i: int.
	 	i = t  -&gt; <a href="#binary_l_67">binary_l</a> x n -&gt; <a href="#basis_ket_185">basis_ket</a> result x y i = <a href="#xor_97">xor</a>  (x co) (x t) }
         <span class="keyword">ensures</span>{<span class="keyword">forall</span>  x y. <a href="#ang_ind_186">ang_ind</a> result x y  = <a href="#ang_zero_113">ang_zero</a>}
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> d: <a href="#circuit_32">circuit</a>. <span class="keyword">forall</span>  x y i.
	 	<a href="#width_187">width</a> d = n -&gt; i &lt;&gt; t -&gt; <a href="#basis_ket_185">basis_ket</a> (d <a href="#infix%20--_227">--</a> result) x y i =  <a href="#basis_ket_185">basis_ket</a> d x y i}
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> d: <a href="#circuit_32">circuit</a>. <span class="keyword">forall</span>  x y i.
	 	<a href="#binary_l_67">binary_l</a> x n -&gt;<a href="#binary_l_67">binary_l</a> y (<a href="#range_184">range</a> d) -&gt;  <a href="#width_187">width</a> d = n -&gt;   i = t  -&gt;
			 <a href="#basis_ket_185">basis_ket</a> (d <a href="#infix%20--_227">--</a>result) x y i = <a href="#xor_97">xor</a>  ( <a href="#basis_ket_185">basis_ket</a> d x y co) ( <a href="#basis_ket_185">basis_ket</a> d x y t) }
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> d: <a href="#circuit_32">circuit</a>. <span class="keyword">forall</span> x y:int-&gt;int.
	 	<a href="#width_187">width</a> d = n -&gt;  <a href="#ang_ind_186">ang_ind</a> (d<a href="#infix%20--_227">--</a>result)  x y = <a href="#ang_ind_186">ang_ind</a> d x y }
</pre>
<div class="info"><p>A generic controlled not gate, bitflipping its target qbit when its control qubit holds value 1. Note that it is provided postcondition pre-interpreting a left sequential composition.</p>
</div><h2>Proof accelerating material</h2>
<p>In this section we provide further material, built on the definition above, and enabling further automation in specifications proofs</p>
<h3>Remarkable fragments</h3>
<p>Upon the algebraic constrcution, certain fragments hold specific properties, stable by composition and enabling a simplified treatment of the path-sum analysis.
We introduce the &quot;diagonal&quot; and the &quot;flat_mute&quot; fragments.</p>
<h4>Diagonal fragment</h4>
<pre><span class="keyword">predicate</span> <a name="diag_circ_272">diag_circ</a> (d:<a href="#circuit_32">circuit</a>)
</pre>
<div class="info"><p>A diagonal circuit does not introduce any superposition nor boolean operation.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="diag_circ_basis_ket_274">diag_circ_basis_ket</a> (d:<a href="#circuit_32">circuit</a>) (x y:int-&gt;int)
    <span class="keyword">requires</span>{<a href="#diag_circ_272">diag_circ</a> d}
    <span class="keyword">ensures</span>{<a href="#basis_ket_185">basis_ket</a> d x y  = x }

<span class="keyword">val</span> <span class="keyword">function</span> <a name="seq_diag_280">seq_diag</a> ( d e:<a href="#circuit_32">circuit</a>) :<a href="#circuit_32">circuit</a>
               <span class="keyword">requires</span>{<a href="#width_187">width</a> d = <a href="#width_187">width</a> e}
               <span class="keyword">requires</span>{<a href="#diag_circ_272">diag_circ</a> d}
               <span class="keyword">requires</span>{<a href="#diag_circ_272">diag_circ</a> e}
               <span class="keyword">ensures</span>{<a href="#diag_circ_272">diag_circ</a> result}
               <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = <a href="#width_187">width</a> d}
               <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = 0}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="#ang_ind_186">ang_ind</a> result x y =  <a href="#ang_ind_186">ang_ind</a> d x y  <a href="#infix%20+.+_119">+.+</a> <a href="#ang_ind_186">ang_ind</a> e x y }
	       <span class="keyword">ensures</span>{result = d <a href="#infix%20--_227">--</a>e}
</pre>
<div class="info"><p>Simplified specification for the sequence of two diagonal circuits.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="seq_diag_right_291">seq_diag_right</a> ( d e:<a href="#circuit_32">circuit</a>)  :<a href="#circuit_32">circuit</a>
               <span class="keyword">requires</span>{<a href="#width_187">width</a> d = <a href="#width_187">width</a> e}
               <span class="keyword">requires</span>{<a href="#diag_circ_272">diag_circ</a> e}
               <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = <a href="#width_187">width</a> d}
               <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = <a href="#range_184">range</a> d}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y i. <a href="#basis_ket_185">basis_ket</a> result x y i= <a href="#basis_ket_185">basis_ket</a> d x y i}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.
	       <a href="#ang_ind_186">ang_ind</a> result x y  =
                   (<a href="#ang_ind_186">ang_ind</a> d x y) <a href="#infix%20+.+_119">+.+</a> (<a href="#ang_ind_186">ang_ind</a> e (<a href="#basis_ket_185">basis_ket</a> d x y)  (<span class="keyword">fun</span> k -&gt; y (k<a href="int.html#infix%20+_19">+</a> <a href="#range_184">range</a> d)))}
	       <span class="keyword">ensures</span>{result = d <a href="#infix%20--_227">--</a>e}
</pre>
<div class="info"><p>Simplified specification for the sequence of two circuits, the second one being diagonal.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="seq_diag_left_303">seq_diag_left</a> ( d e:<a href="#circuit_32">circuit</a>)  :<a href="#circuit_32">circuit</a>
               <span class="keyword">requires</span>{<a href="#width_187">width</a> d = <a href="#width_187">width</a> e}
               <span class="keyword">requires</span>{<a href="#diag_circ_272">diag_circ</a>  d}
               <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = <a href="#width_187">width</a> d}
               <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = <a href="#range_184">range</a> e}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="#basis_ket_185">basis_ket</a> result x y i =  <a href="#basis_ket_185">basis_ket</a> e x y  i}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="#ang_ind_186">ang_ind</a> result x y  =   (<a href="#ang_ind_186">ang_ind</a> d x y) <a href="#infix%20+.+_119">+.+</a> (<a href="#ang_ind_186">ang_ind</a> e x  y)}
	       <span class="keyword">ensures</span>{result = d <a href="#infix%20--_227">--</a>e}
</pre>
<div class="info"><p>Simplified specification for the sequence of two circuits, the first one being diagonal.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="crz_313">crz</a> (c t k n:int):<a href="#circuit_32">circuit</a>
      <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> c <a href="int.html#infix%20%3C_21">&lt;</a> n}
      <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> t <a href="int.html#infix%20%3C_21">&lt;</a> n}
      <span class="keyword">requires</span>{c&lt;&gt;t}
      <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = n}
      <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = 0}
      <span class="keyword">ensures</span>{<a href="#diag_circ_272">diag_circ</a> result}
<span class="keyword">ensures</span>{<span class="keyword">forall</span> x y k&#39;. 0<a href="int.html#infix%20%3C=_25">&lt;=</a> k<a href="int.html#infix%20%3C=_25">&lt;=</a> k&#39; -&gt;
      		     <a href="#ang_ind_186">ang_ind</a> result x y  = (x c <a href="int.html#infix%20*_20">*</a> x t <a href="int.html#infix%20*_20">*</a><a href="#power_33">power</a> 2 (k&#39;<a href="int.html#infix%20-_23">-</a>k))<a href="#infix%20/./_116">/./</a>k&#39;}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> d x y k&#39;.  <a href="#width_187">width</a> d = n -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a> k<a href="int.html#infix%20%3C=_25">&lt;=</a> k&#39; -&gt;
      		     <a href="#ang_ind_186">ang_ind</a> (d <a href="#infix%20--_227">--</a> result) x y  =
	       (<a href="#ang_ind_186">ang_ind</a> d x y) <a href="#infix%20+.+_119">+.+</a>  ((<a href="#basis_ket_185">basis_ket</a> d x y) c <a href="int.html#infix%20*_20">*</a> (<a href="#basis_ket_185">basis_ket</a> d x y) t <a href="int.html#infix%20*_20">*</a><a href="#power_33">power</a> 2 (k&#39;<a href="int.html#infix%20-_23">-</a>k))<a href="#infix%20/./_116">/./</a>k&#39;}
</pre>
<div class="info"><p>Controlled Z rotation, applying a Z rotation of angle (1/ 2^k) on qubit &#39;t&#39; if qubit &#39;c&#39; holds value 1, in a &#39;n&#39; qubits register.</p>
</div><h4>Flate_mute fragment</h4>
<p>Another prpoperty catches purely boolean circuits, with no superposition nor phase differenciation</p>
<pre><span class="keyword">predicate</span> <a name="flat_mute_circ_331">flat_mute_circ</a> (d:<a href="#circuit_32">circuit</a>)

<span class="keyword">val</span> <span class="keyword">lemma</span> <a name="flat_mute_circ_ang_ind_334">flat_mute_circ_ang_ind</a> (d:<a href="#circuit_32">circuit</a>) (x y:int -&gt; int)
    <span class="keyword">requires</span>{<a href="#flat_mute_circ_331">flat_mute_circ</a> d}
    <span class="keyword">ensures</span>{<a href="#ang_ind_186">ang_ind</a> d x y  = <a href="#ang_zero_113">ang_zero</a>}

<span class="keyword">val</span> <span class="keyword">function</span> <a name="seq_flat_mute_339">seq_flat_mute</a> ( d e:<a href="#circuit_32">circuit</a>) :<a href="#circuit_32">circuit</a>
               <span class="keyword">requires</span>{<a href="#width_187">width</a> d = <a href="#width_187">width</a> e}
	       <span class="keyword">requires</span>{<a href="#flat_mute_circ_331">flat_mute_circ</a> d}
	       <span class="keyword">requires</span>{<a href="#flat_mute_circ_331">flat_mute_circ</a> e}
               <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = <a href="#width_187">width</a> d}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="#binary_l_67">binary_l</a>  x (<a href="#width_187">width</a> d) -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a>i <a href="int.html#infix%20%3C_21">&lt;</a> <a href="#width_187">width</a> d -&gt;
	       		      <a href="#basis_ket_185">basis_ket</a> result x y i =  <a href="#basis_ket_185">basis_ket</a> e (<a href="#basis_ket_185">basis_ket</a> d x y) y i}
               <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = <a href="#width_187">width</a> d}
               <span class="keyword">ensures</span>{<a href="#flat_mute_circ_331">flat_mute_circ</a> result}
	       <span class="keyword">ensures</span>{result = d <a href="#infix%20--_227">--</a>e}
</pre>
<div class="info"><p>Simplified specification for the sequence of two flat_mute circuits.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="seq_flat_mute_right_352">seq_flat_mute_right</a> ( d e:<a href="#circuit_32">circuit</a>)  :<a href="#circuit_32">circuit</a>
               <span class="keyword">requires</span>{<a href="#width_187">width</a> d = <a href="#width_187">width</a> e}
	       <span class="keyword">requires</span>{<a href="#flat_mute_circ_331">flat_mute_circ</a> e}
               <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = <a href="#width_187">width</a> d}
               <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = <a href="#range_184">range</a> d}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="#binary_l_67">binary_l</a>  x (<a href="#width_187">width</a> d) -&gt; <a href="#binary_l_67">binary_l</a>  y (<a href="#range_184">range</a>  d) -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> <a href="#width_187">width</a> d -&gt;<a href="#basis_ket_185">basis_ket</a> result x y i =
                                                                                                                                  <a href="#basis_ket_185">basis_ket</a> e (<a href="#basis_ket_185">basis_ket</a> d x y)  (<span class="keyword">fun</span> k -&gt; y (k <a href="int.html#infix%20+_19">+</a> <a href="#range_184">range</a> d)) i}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.  <a href="#binary_l_67">binary_l</a>  x (<a href="#width_187">width</a> d) -&gt; <a href="#binary_l_67">binary_l</a>  y (<a href="#range_184">range</a>  d) -&gt; <a href="#ang_ind_186">ang_ind</a> result x y  =
                                                                                                   (<a href="#ang_ind_186">ang_ind</a> d x y)}
	       <span class="keyword">ensures</span>{result = d <a href="#infix%20--_227">--</a>e}
</pre>
<div class="info"><p>Simplified specification for the sequence of two circuits, the second one being flat_mute.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="seq_flat_mute_left_365">seq_flat_mute_left</a> ( d e:<a href="#circuit_32">circuit</a>)  :<a href="#circuit_32">circuit</a>
               <span class="keyword">requires</span>{<a href="#width_187">width</a> d = <a href="#width_187">width</a> e}
	       <span class="keyword">requires</span>{<a href="#flat_mute_circ_331">flat_mute_circ</a> d}
               <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = <a href="#width_187">width</a> d}
               <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = <a href="#range_184">range</a> e}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="#binary_l_67">binary_l</a>  x (<a href="#width_187">width</a> d) -&gt; <a href="#binary_l_67">binary_l</a>  y (<a href="#range_184">range</a>  e) -&gt;0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> <a href="#width_187">width</a> d -&gt; <a href="#basis_ket_185">basis_ket</a> result x y i =
                                                                                                                                  <a href="#basis_ket_185">basis_ket</a> e (<a href="#basis_ket_185">basis_ket</a> d x y) y i}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="#binary_l_67">binary_l</a>  x (<a href="#width_187">width</a> d) -&gt;<a href="#binary_l_67">binary_l</a>  y (<a href="#range_184">range</a>  e) -&gt;<a href="#ang_ind_186">ang_ind</a> result x y  =
                                                                                                <a href="#ang_ind_186">ang_ind</a> e (<a href="#basis_ket_185">basis_ket</a> d x y)  y}
	       <span class="keyword">ensures</span>{result = d <a href="#infix%20--_227">--</a>e}
</pre>
<div class="info"><p>Simplified specification for the sequence of two circuits, the first one being flat_mute.</p>
</div><pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="rm_skip_378">rm_skip</a> (k:int): <a href="#circuit_32">circuit</a>
        <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C_21">&lt;</a>k}
	<span class="keyword">ensures</span>{<a href="#diag_circ_272">diag_circ</a> result}
	<span class="keyword">ensures</span>{<a href="#flat_mute_circ_331">flat_mute_circ</a> result}
        <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = k}
</pre>
<div class="info"><p>A &quot;flat_mute&quot; version of the parametrized skip.</p>
</div><h4>Additional material</h4>
<pre><span class="keyword">val</span> <span class="keyword">function</span> <a name="place_hadamard_387">place_hadamard</a>   (k n:int)  : <a href="#circuit_32">circuit</a>
     <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a>n}
     <span class="keyword">ensures</span>{<a href="#range_184">range</a> result = 1}
     <span class="keyword">ensures</span>{<a href="#width_187">width</a> result = n}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int.
     		    0<a href="int.html#infix%20%3C=_25">&lt;=</a>i<a href="int.html#infix%20%3C_21">&lt;</a>n -&gt;<a href="#basis_ket_185">basis_ket</a> result x y i = <span class="keyword">if</span> i = k <span class="keyword">then</span> y 0 <span class="keyword">else</span> x i}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.
     		    <a href="#ang_ind_186">ang_ind</a> result x y  =  (x k <a href="int.html#infix%20*_20">*</a> y 0) <a href="#infix%20/./_116">/./</a> 1}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> m:int.
     		    1<a href="int.html#infix%20%3C=_25">&lt;=</a> m -&gt;  <a href="#ang_ind_186">ang_ind</a> result x y  = (x k <a href="int.html#infix%20*_20">*</a> y 0<a href="int.html#infix%20*_20">*</a><a href="#power_33">power</a> 2 (m<a href="int.html#infix%20-_23">-</a>1)) <a href="#infix%20/./_116">/./</a> m }
</pre>
<div class="info"><p>An example macro, for applying the Hadamard gate on a register of size &quot;n&quot; -- note it provides a solution for  one of the questions from the GHZ exercise.</p>
</div><p>The three following lemmas provide an embryonic treatment of angle function as an object. Concretely, they reason about big sum functional addition.</p>
<pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ang_sum_comp_re_diag_402">ang_sum_comp_re_diag</a> (f:(int-&gt;int) -&gt;  int -&gt;int -&gt; <a href="#angle_110">angle</a>) (c d:<a href="#circuit_32">circuit</a>) (q i j:int)
    <span class="keyword">requires</span>{i<a href="int.html#infix%20%3C=_25">&lt;=</a>j}
    <span class="keyword">requires</span>{<a href="#width_187">width</a> c = <a href="#width_187">width</a> d}
    <span class="keyword">requires</span>{<a href="#diag_circ_272">diag_circ</a> c}
    <span class="keyword">requires</span>{<a href="#diag_circ_272">diag_circ</a> d}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y. <a href="#ang_ind_186">ang_ind</a> c x y = <a href="#ang_sum_147">ang_sum</a> (f x q) i j}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y.  <a href="#ang_ind_186">ang_ind</a> d x y   = f x  q j}
    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="#ang_ind_186">ang_ind</a> (<a href="#seq_diag_280">seq_diag</a> c d) x y = <a href="#ang_sum_147">ang_sum</a> (f x q) i (j<a href="int.html#infix%20+_19">+</a>1)}
</pre>
<div class="info"><p>Right composition for diagonal circuits</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ang_sum_comp_re_412">ang_sum_comp_re</a> (f:(int-&gt;int) -&gt; (int-&gt;int) -&gt;  int  -&gt; int  -&gt; <a href="#angle_110">angle</a>) (c d:<a href="#circuit_32">circuit</a>) (q i j:int)
<span class="keyword">requires</span>{i<a href="int.html#infix%20%3C_21">&lt;</a>j}
<span class="keyword">requires</span>{<a href="#width_187">width</a> c = <a href="#width_187">width</a> d}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y.  <a href="#ang_ind_186">ang_ind</a> c x y   =  <a href="#ang_sum_147">ang_sum</a> (f x y q) i (j<a href="int.html#infix%20-_23">-</a>1)}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y. <a href="#ang_ind_186">ang_ind</a> d (<a href="#basis_ket_185">basis_ket</a> c x y) (<span class="keyword">fun</span> i  -&gt; y(i<a href="int.html#infix%20+_19">+</a><a href="#range_184">range</a> c)) = f x y q (j<a href="int.html#infix%20-_23">-</a>1)}
    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="#ang_ind_186">ang_ind</a> (c <a href="#infix%20--_227">--</a> d) x y = <a href="#ang_sum_147">ang_sum</a> (f x y q) i j}
</pre>
<div class="info"><p>Right composition in the general case</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="ang_sum_comp_plus_one_420">ang_sum_comp_plus_one</a> (f:(int-&gt;int) -&gt; (int-&gt;int) -&gt;  int  -&gt; int  -&gt; <a href="#angle_110">angle</a>) (c d:<a href="#circuit_32">circuit</a>) (q i j:int)
<span class="keyword">requires</span>{i<a href="int.html#infix%20%3C_21">&lt;</a>j}
<span class="keyword">requires</span>{<a href="#width_187">width</a> c = <a href="#width_187">width</a> d}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y.  <a href="#ang_ind_186">ang_ind</a> c x y   = f x y q i}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y. <a href="#ang_ind_186">ang_ind</a> d (<a href="#basis_ket_185">basis_ket</a> c x y) (<span class="keyword">fun</span> i  -&gt; y(i<a href="int.html#infix%20+_19">+</a><a href="#range_184">range</a> c)) = <a href="#ang_sum_147">ang_sum</a> (f x y q) (i<a href="int.html#infix%20+_19">+</a>1) j}
    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="#ang_ind_186">ang_ind</a> (c <a href="#infix%20--_227">--</a> d) x y = <a href="#ang_sum_147">ang_sum</a> (f x y q) i j}
</pre>
<div class="info"><p>Left composition in the general case</p>
</div><pre><span class="keyword">val</span> <span class="keyword">lemma</span> <a name="phase_binary_prod_decomp_429">phase_binary_prod_decomp</a> (n :int)
        <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C_21">&lt;</a>n}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="#binary_l_67">binary_l</a> x n -&gt; <a href="#binary_l_67">binary_l</a> y n -&gt;(<a href="#ind_isum_36">ind_isum</a> (<span class="keyword">fun</span> j -&gt; <a href="#ind_isum_36">ind_isum</a> (<span class="keyword">fun</span> i -&gt;   x i <a href="int.html#infix%20*_20">*</a>  y j <a href="int.html#infix%20*_20">*</a> <a href="#power_33">power</a> 2 (n<a href="int.html#infix%20-_23">-</a>i<a href="int.html#infix%20-_23">-</a>1<a href="int.html#infix%20+_19">+</a>j)) j n) 0 n) <a href="#infix%20/./_116">/./</a>n
               =  (<a href="#bv_to_int_93">bv_to_int</a> (<a href="#make_bv_85">make_bv</a> x n) <a href="int.html#infix%20*_20">*</a> <a href="#bv_to_int_93">bv_to_int</a> (<a href="#bv_inversion_90">bv_inversion</a> (<a href="#make_bv_85">make_bv</a> y n))) <a href="#infix%20/./_116">/./</a>n}
</pre>
<div class="info"><p>The following lemma encapsulates a post-treatment for the Quantum FOurier Transform basis_ket function: the composing path-sum analysis ends up with an integer product shaped as the decopposition product for their binary decomposition. In addition, therm &quot;y&quot; is big endian and null modulo 2^n terms are ommitted. Here only a final lemma is provided, refering to lemma int_to_ang_by_sum_mult_break from file math_lib/unit.circle, l. 1533</p>
</div><pre><span class="keyword">end</span>

<span class="keyword">module</span> <a name="Tool_box_Real'impl_">Tool_box_Real</a>:<a href="#Tool_box_Intf_">Tool_box_Intf</a>
</pre>
<div class="info"><p>This module is a realization of interface Tool_box_Intf -- built on the Qbricks library, it imports all the specifications from its interface</p>
</div><pre>         <span class="keyword">use</span>   int.<a href="int.html#EuclideanDivision_">EuclideanDivision</a>
         <span class="keyword">use</span>  extr_int.<a href="extr_int.html#Ind_isum_">Ind_isum</a>
         <span class="keyword">use</span> arit.<a href="arit.html#Div_Mod_">Div_Mod</a>
         <span class="keyword">use</span> wired_circuits.<a href="wired_circuits.html#Qbricks_prim_">Qbricks_prim</a>
         <span class="keyword">use</span> qbricks.<a href="qbricks.html#Circuit_macros_">Circuit_macros</a>
         <span class="keyword">use</span> qbricks.<a href="qbricks.html#Circuit_semantics_">Circuit_semantics</a>
         <span class="keyword">use</span>  binary.<a href="binary.html#Bit_vector_">Bit_vector</a>
         <span class="keyword">use</span>  p_int.<a href="p_int.html#Int_comp_">Int_comp</a>
         <span class="keyword">use</span>  ref.<a href="ref.html#Ref_">Ref</a>
         <span class="keyword">use</span>  int_expo.<a href="int_expo.html#Int_Exponentiation_">Int_Exponentiation</a>
         <span class="keyword">use</span> remarkable_fragments.<a href="remarkable_fragments.html#Diag_circuits_">Diag_circuits</a>
         <span class="keyword">use</span> qbricks.<a href="qbricks.html#Circuit_semantics_">Circuit_semantics</a>
         <span class="keyword">use</span>  unit_circle.<a href="unit_circle.html#Angle_">Angle</a>
         <span class="keyword">use</span> unit_circle.<a href="unit_circle.html#Ang_sum_">Ang_sum</a>
	 <span class="keyword">use</span>  binary.<a href="binary.html#Binary_Op_">Binary_Op</a>
         <span class="keyword">use</span>  wired_circuits.<a href="wired_circuits.html#Circuit_c_">Circuit_c</a>
	 <span class="keyword">use</span>  binary.<a href="binary.html#Bit_vector_inversions_">Bit_vector_inversions</a>
	 <span class="keyword">use</span> fsum.<a href="fsum.html#Int_iter_">Int_iter</a>
	 <span class="keyword">use</span> complex_operations.<a href="complex_operations.html#FromInt_">FromInt</a>
	 <span class="keyword">use</span> complex.<a href="complex.html#Complex_">Complex</a>
         <span class="keyword">use</span> fsum.<a href="fsum.html#Int_iter_">Int_iter</a>
         <span class="keyword">use</span>  int.<a href="int.html#Int_">Int</a>
	 <span class="keyword">use</span> remarkable_fragments.<a href="remarkable_fragments.html#Flat_mute_circuits_">Flat_mute_circuits</a>
	 <span class="keyword">use</span> remarkable_fragments.<a href="remarkable_fragments.html#Diag_circuits_">Diag_circuits</a>

<span class="keyword">let</span>  <span class="keyword">function</span> <a name="power_465">power</a> (e i:int)  : int
    = <a href="int_expo.html#power_37">power</a> e i

<span class="keyword">let</span>   <span class="keyword">function</span> <a name="ind_isum_468">ind_isum</a>  (f :int -&gt; int) (i:int) (j:int):int
  = <a href="extr_int.html#ind_isum_37">ind_isum</a> f i j

<span class="keyword">let</span>  <span class="keyword">lemma</span> <a name="ind_isum_eq_471">ind_isum_eq</a> (f g : int -&gt; int) (i i1 j j1:int)
       <span class="keyword">requires</span>{<span class="keyword">forall</span> k : int. i <a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> j -&gt; f k = g k}
       <span class="keyword">requires</span>{i = i1}
       <span class="keyword">requires</span>{j = j1}
       <span class="keyword">ensures</span>{ <a href="#ind_isum_468">ind_isum</a>  f i j = <a href="#ind_isum_468">ind_isum</a>   g i1 j1}
  =
  <a href="extr_int.html#ind_isum_eq_gen_151">ind_isum_eq_gen</a>  f g i i1  j j1

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ind_isum_empty_479">ind_isum_empty</a> (f :int -&gt; int) (i:int) (j:int)
       <span class="keyword">requires</span>{j <a href="int.html#infix%20%3C=_25">&lt;=</a> i}
       <span class="keyword">ensures</span>{ <a href="#ind_isum_468">ind_isum</a>  f i j =  0}
  = <a href="extr_int.html#ind_isum_empty_46">ind_isum_empty</a> f i j

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ind_isum_re_484">ind_isum_re</a> (f :int -&gt; int) (i:int) (j:int)
       <span class="keyword">requires</span>{i <a href="int.html#infix%20%3C_21">&lt;</a> j}
       <span class="keyword">ensures</span>{<a href="#ind_isum_468">ind_isum</a> f i j = <a href="#ind_isum_468">ind_isum</a> f i (j<a href="int.html#infix%20-_23">-</a>1) <a href="int.html#infix%20+_19">+</a> f (j<a href="int.html#infix%20-_23">-</a>1)}
  =<a href="extr_int.html#ind_isum_re_100">ind_isum_re</a> f i j;
   ()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ind_isum_plus_one_490">ind_isum_plus_one</a> (f :int -&gt; int) (i:int) (j:int)
       <span class="keyword">requires</span>{i <a href="int.html#infix%20%3C_21">&lt;</a> j}
       <span class="keyword">ensures</span>{ <a href="#ind_isum_468">ind_isum</a>  f i j =  (f i) <a href="int.html#infix%20+_19">+</a> ( <a href="#ind_isum_468">ind_isum</a>  f (i<a href="int.html#infix%20+_19">+</a>1) j)}
  = <a href="extr_int.html#ind_isum_plus_one_59">ind_isum_plus_one</a> f i j

<span class="keyword">type</span> <a name="bitvec_495">bitvec</a> = Bit_vector.<a href="binary.html#bitvec_220">bitvec</a>

<span class="keyword">predicate</span> <a name="binary_l_497">binary_l</a> (t: int-&gt;int) (l:int)
= <span class="keyword">forall</span> k : int. 0 <a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> l -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a> t k <a href="int.html#infix%20%3C_21">&lt;</a>2

 <span class="keyword">let</span> <span class="keyword">lemma</span> <a name="set_binary_l_500">set_binary_l</a> (t: int-&gt;int)  (l:int)
       <span class="keyword">requires</span>{<span class="keyword">forall</span> k : int.  0 <a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> l -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a> t k <a href="int.html#infix%20%3C_21">&lt;</a>2 }
       <span class="keyword">ensures</span>{<a href="#binary_l_497">binary_l</a> t l}
   =<a href="binary.html#set_binary_l_36">set_binary_l</a> t l

 <span class="keyword">let</span> <span class="keyword">lemma</span> <a name="get_binary_l_505">get_binary_l</a> (t: int-&gt;int)  (l:int)
       <span class="keyword">requires</span>{<a href="#binary_l_497">binary_l</a> t l}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> k : int.  0 <a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> l -&gt;0<a href="int.html#infix%20%3C=_25">&lt;=</a> t k <a href="int.html#infix%20%3C_21">&lt;</a>2 }
   = <a href="binary.html#get_binary_l_41">get_binary_l</a> t l

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="binary_prefix_510">binary_prefix</a> (x: int-&gt; int)( n n&#39;:int)
       <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>n&#39;<a href="int.html#infix%20%3C=_25">&lt;=</a>n}
       <span class="keyword">requires</span>{<a href="#binary_l_497">binary_l</a> x n}
       <span class="keyword">ensures</span>{<a href="#binary_l_497">binary_l</a> x n&#39;}
=
<a href="#get_binary_l_505">get_binary_l</a> x n;
<a href="#set_binary_l_500">set_binary_l</a> x n&#39;

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="binary_init_518">binary_init</a> (x: int-&gt; int)( n :int)
       <span class="keyword">requires</span>{n =0}
       <span class="keyword">ensures</span>{<a href="#binary_l_497">binary_l</a> x n}
=()

<span class="keyword">let</span> <span class="keyword">function</span> <a name="make_bv_523">make_bv</a> (f:int-&gt;int) (s:int): (<a href="#bitvec_495">bitvec</a>)
       <span class="keyword">requires</span>{<a href="#binary_l_497">binary_l</a> f s}
       <span class="keyword">requires</span>{s<a href="int.html#infix%20%3E=_26">&gt;=</a>0}
       <span class="keyword">ensures</span>{<a href="binary.html#length_222">length</a> result = s}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> i:int.  0<a href="int.html#infix%20%3C=_25">&lt;=</a>i <a href="int.html#infix%20%3C_21">&lt;</a> s -&gt;  <a href="binary.html#getbv_237">getbv</a> result i =  f i}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> i:int. <span class="keyword">not</span> ( 0<a href="int.html#infix%20%3C=_25">&lt;=</a>i <a href="int.html#infix%20%3C_21">&lt;</a> s) -&gt;  <a href="binary.html#getbv_237">getbv</a> result i = 0}
  = <a href="binary.html#make_bv_427">make_bv</a> f s

<span class="keyword">let</span>  <span class="keyword">function</span> <a name="bv_inversion_531">bv_inversion</a> (bv:<a href="#bitvec_495">bitvec</a>):<a href="#bitvec_495">bitvec</a>
       <span class="keyword">ensures</span>{<a href="binary.html#length_222">length</a> result = <a href="binary.html#length_222">length</a> bv}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> k. <a href="binary.html#in_range_404">in_range</a> result k -&gt; <a href="binary.html#getbv_237">getbv</a> result k = <a href="binary.html#getbv_237">getbv</a> bv (<a href="binary.html#length_222">length</a> bv <a href="int.html#infix%20-_23">-</a> k <a href="int.html#infix%20-_23">-</a>1)}
  = <a href="binary.html#bv_inversion_1546">bv_inversion</a> bv

<span class="keyword">let</span>  <span class="keyword">function</span> <a name="bv_to_int_536">bv_to_int</a> (bv: <a href="#bitvec_495">bitvec</a>): int
       <span class="keyword">ensures</span>{result = <a href="#ind_isum_468">ind_isum</a> (<span class="keyword">fun</span> k -&gt; (<a href="binary.html#getbv_237">getbv</a> bv k) <a href="int.html#infix%20*_20">*</a> (<a href="#power_465">power</a> 2 ((<a href="binary.html#length_222">length</a> bv <a href="int.html#infix%20-_23">-</a>1) <a href="int.html#infix%20-_23">-</a>k))) 0 (<a href="binary.html#length_222">length</a> bv) }
       <span class="keyword">ensures</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> result}
  = <a href="binary.html#bv_to_int_605">bv_to_int</a> bv

<span class="keyword">let</span> <span class="keyword">function</span> <a name="xor_541">xor</a> a b
       <span class="keyword">ensures</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>a<a href="int.html#infix%20%3C_21">&lt;</a>2 -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a> b <a href="int.html#infix%20%3C_21">&lt;</a> 2 -&gt; result = a <a href="int.html#infix%20*_20">*</a>(1<a href="int.html#infix%20-_23">-</a>b) <a href="int.html#infix%20+_19">+</a> b <a href="int.html#infix%20*_20">*</a>(1<a href="int.html#infix%20-_23">-</a>a)}
= <a href="int.html#mod_174">mod</a> (a <a href="int.html#infix%20+_19">+</a>b) 2

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="xor_eq_545">xor_eq</a> (a b a&#39; b&#39;:int)
       <span class="keyword">requires</span>{a=a&#39;}
       <span class="keyword">requires</span>{b=b&#39;}
       <span class="keyword">ensures</span>{<a href="#xor_541">xor</a> a  b= <a href="#xor_541">xor</a> a&#39;  b&#39;}
=()

<span class="keyword">type</span> <a name="angle_551">angle</a> = Angle.<a href="unit_circle.html#angle_30">angle</a>
<span class="keyword">let</span> <span class="keyword">function</span> (<a name="infix%20+.+_552">+.+</a>) : <a href="#angle_551">angle</a> -&gt; <a href="#angle_551">angle</a> -&gt; <a href="#angle_551">angle</a> = Angle.(<a href="unit_circle.html#infix%20+.+_36">+.+</a>)

<span class="keyword">let</span> <span class="keyword">constant</span>  <a name="ang_zero_554">ang_zero</a>
 = Angle.<a href="unit_circle.html#ang_zero_49">ang_zero</a>
       <span class="keyword">ensures</span>{result = <a href="unit_circle.html#ang_zero_49">ang_zero</a>}

<span class="keyword">let</span> <span class="keyword">function</span> (<a name="infix%20/./_558">/./</a>) (k:int) (n:int) :<a href="#angle_551">angle</a>
       <span class="keyword">ensures</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>n -&gt; result = <a href="unit_circle.html#real_to_ang_46">real_to_ang</a> (<a href="complex_operations.html#i_to_c_1151">i_to_c</a> (<a href="int.html#mod_174">mod</a> k (<a href="#power_465">power</a> 2 n)) <a href="complex.html#infix%20/._174">/.</a> <a href="complex_operations.html#i_to_c_1151">i_to_c</a> (<a href="#power_465">power</a> 2 n))}
       <span class="keyword">ensures</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>n -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> <a href="#power_465">power</a> 2 n-&gt; <a href="unit_circle.html#ang_meas_39">ang_meas</a>  result = (<a href="complex_operations.html#i_to_c_1151">i_to_c</a> k <a href="complex.html#infix%20/._174">/.</a> <a href="complex_operations.html#i_to_c_1151">i_to_c</a> (<a href="#power_465">power</a> 2 n))}
       <span class="keyword">ensures</span>{n <a href="int.html#infix%20%3C_21">&lt;</a>0 -&gt; result = <a href="unit_circle.html#real_to_ang_46">real_to_ang</a> (<a href="complex_operations.html#i_to_c_1151">i_to_c</a> (<a href="int.html#mod_174">mod</a> (<a href="int.html#prefix%20-_18">-</a>k) (<a href="#power_465">power</a> 2 (<a href="int.html#prefix%20-_18">-</a>n))) <a href="complex.html#infix%20/._174">/.</a> <a href="complex_operations.html#i_to_c_1151">i_to_c</a> (<a href="#power_465">power</a> 2 (<a href="int.html#prefix%20-_18">-</a>n)))}
       <span class="keyword">ensures</span>{n <a href="int.html#infix%20%3C_21">&lt;</a>0 -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> <a href="#power_465">power</a> 2 n-&gt; <a href="unit_circle.html#ang_meas_39">ang_meas</a>  result = (<a href="complex_operations.html#i_to_c_1151">i_to_c</a> (<a href="int.html#prefix%20-_18">-</a>k) <a href="complex.html#infix%20/._174">/.</a> <a href="complex_operations.html#i_to_c_1151">i_to_c</a> (<a href="#power_465">power</a> 2 (<a href="int.html#prefix%20-_18">-</a>n)))}
  =  Angle.(<a href="unit_circle.html#infix%20/./_338">/./</a>) k n

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ang_add_eq_565">ang_add_eq</a> (d1 d2 e1 e2:<a href="#angle_551">angle</a>)
       <span class="keyword">requires</span>{d1 = e1}
       <span class="keyword">requires</span>{d2 = e2}
       <span class="keyword">ensures</span>{d1 <a href="#infix%20+.+_552">+.+</a> d2 = e1 <a href="#infix%20+.+_552">+.+</a> e2}
  =<a href="unit_circle.html#ang_add_eq_727">ang_add_eq</a> d1 d2 e1 e2

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="int_to_ang_add_rev_571">int_to_ang_add_rev</a> (i j n:int)
       <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> n}
       <span class="keyword">ensures</span>{(i <a href="int.html#infix%20+_19">+</a> j) <a href="#infix%20/./_558">/./</a> n =  (i <a href="#infix%20/./_558">/./</a> n)<a href="#infix%20+.+_552">+.+</a> (j <a href="#infix%20/./_558">/./</a> n) }
  =()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="int_to_ang_eq_576">int_to_ang_eq</a> (k1 k2 n1 n2: int)
        <span class="keyword">requires</span>{k1=k2}
        <span class="keyword">requires</span>{n1=n2}
        <span class="keyword">ensures</span>{k1 <a href="#infix%20/./_558">/./</a> n1 = k2 <a href="#infix%20/./_558">/./</a> n2}
  =()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ang_add_zero_582">ang_add_zero</a> (d&#39; d:<a href="#angle_551">angle</a>)
        <span class="keyword">requires</span>{d&#39; = <a href="#ang_zero_554">ang_zero</a>}
        <span class="keyword">ensures</span>{d <a href="#infix%20+.+_552">+.+</a>  d&#39; = d}
  =()

<span class="keyword">let</span>  <span class="keyword">function</span> <a name="ang_sum_587">ang_sum</a> (f : int -&gt; <a href="#angle_551">angle</a>) (i j:int):<a href="#angle_551">angle</a>
  = <a href="unit_circle.html#ang_sum_986">ang_sum</a> f i j

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ang_sum_plus_one_590">ang_sum_plus_one</a> (f :int -&gt; <a href="#angle_551">angle</a>) (i:int) (j:int)
      <span class="keyword">requires</span>{i<a href="int.html#infix%20%3C_21">&lt;</a> j}
      <span class="keyword">ensures</span>{ <a href="#ang_sum_587">ang_sum</a> f i j =  (f i)<a href="#infix%20+.+_552">+.+</a>(<a href="#ang_sum_587">ang_sum</a> f (i<a href="int.html#infix%20+_19">+</a>1) j)}
  = <span class="keyword">if</span> i <a href="int.html#infix%20+_19">+</a>1 <a href="int.html#infix%20=_16">=</a> j <span class="keyword">then</span> <a href="unit_circle.html#ang_sum_cardone_1000">ang_sum_cardone</a> f i j
  <span class="keyword">else</span> <a href="unit_circle.html#ang_sum_plus_one_995">ang_sum_plus_one</a> f i j

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ang_sum_eq_596">ang_sum_eq</a>  (f g : int -&gt; <a href="#angle_551">angle</a>) (i j i&#39; j&#39;:int)
      <span class="keyword">requires</span>{i <a href="int.html#infix%20%3C=_25">&lt;=</a> j}
      <span class="keyword">requires</span>{i = i&#39;}
      <span class="keyword">requires</span>{j = j&#39;}
      <span class="keyword">requires</span>{<span class="keyword">forall</span> k : int. i <a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> j -&gt; f k = g k}
      <span class="keyword">ensures</span>{ <a href="#ang_sum_587">ang_sum</a>  f i j = <a href="#ang_sum_587">ang_sum</a>  g i j}
  = <a href="unit_circle.html#ang_sum_eq_1054">ang_sum_eq</a> f g i j

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ang_sum_empty_604">ang_sum_empty</a> (f :int -&gt; <a href="#angle_551">angle</a>) (i:int) (j:int)
       <span class="keyword">requires</span>{j = i}
       <span class="keyword">ensures</span>{<a href="#ang_sum_587">ang_sum</a>  f i j =  <a href="#ang_zero_554">ang_zero</a>}
  = <a href="unit_circle.html#ang_sum_neutral_1011">ang_sum_neutral</a> f i j

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ang_sum_to_ind_isum_609">ang_sum_to_ind_isum</a> (f: int-&gt; <a href="#angle_551">angle</a>) ( g: int-&gt; int) (n i j:int)
          <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>n}
          <span class="keyword">requires</span>{i <a href="int.html#infix%20%3C_21">&lt;</a> j}
	  <span class="keyword">requires</span>{<span class="keyword">forall</span> k. i<a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a> j-&gt; f k = (g k) <a href="#infix%20/./_558">/./</a> n}
          <span class="keyword">ensures</span>{<a href="#ang_sum_587">ang_sum</a> f i j = (<a href="#ind_isum_468">ind_isum</a> g i j) <a href="#infix%20/./_558">/./</a> n}
  = <a href="unit_circle.html#ang_sum_to_ind_isum_1296">ang_sum_to_ind_isum</a>   g n i j

<span class="keyword">let</span>  <span class="keyword">lemma</span> <a name="ang_sum_re_616">ang_sum_re</a>  (f : int -&gt; <a href="#angle_551">angle</a>) (i j : int)
          <span class="keyword">requires</span>{i <a href="int.html#infix%20+_19">+</a>1 <a href="int.html#infix%20%3C=_25">&lt;=</a> j }
          <span class="keyword">ensures</span>  { (<a href="#ang_sum_587">ang_sum</a> f i j) =  ( (<a href="#ang_sum_587">ang_sum</a> f i (j<a href="int.html#infix%20-_23">-</a>1)) <a href="#infix%20+.+_552">+.+</a> (f (j<a href="int.html#infix%20-_23">-</a>1))) }
  = <a href="unit_circle.html#ang_sum_re_1043">ang_sum_re</a> f i j

 <span class="keyword">type</span> <a name="circuit_621">circuit</a> = Circuit_c.<a href="wired_circuits.html#circuit_274">circuit</a>
 <span class="keyword">function</span> <a name="basis_ket_622">basis_ket</a>: <a href="#circuit_621">circuit</a> -&gt; (int-&gt;int)-&gt;(int-&gt;int)-&gt;int-&gt;int = Circuit_c.<a href="wired_circuits.html#basis_ket_376">basis_ket</a>
  <span class="keyword">function</span> <a name="range_623">range</a> : <a href="#circuit_621">circuit</a> -&gt; int = Circuit_c.<a href="wired_circuits.html#range_288">range</a>
 <span class="keyword">function</span> <a name="ang_ind_624">ang_ind</a>: <a href="#circuit_621">circuit</a> -&gt; (int-&gt;int)-&gt;(int-&gt;int)-&gt;<a href="#angle_551">angle</a> = Circuit_c.<a href="wired_circuits.html#ang_ind_432">ang_ind</a>
 <span class="keyword">function</span> <a name="width_625">width</a>: <a href="#circuit_621">circuit</a>-&gt; int = Circuit_c.<a href="wired_circuits.html#width_354">width</a>

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="binary_basis_ket_627">binary_basis_ket</a> (d:<a href="#circuit_621">circuit</a>)  (x y:int-&gt;int) (n :int)
        <span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> d = n}
        <span class="keyword">requires</span>{<a href="#binary_l_497">binary_l</a> x n}
        <span class="keyword">requires</span>{<a href="#binary_l_497">binary_l</a> y (<a href="wired_circuits.html#range_288">range</a> d)}
        <span class="keyword">ensures</span>{<a href="#binary_l_497">binary_l</a> (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y ) n}
= <a href="#set_binary_l_500">set_binary_l</a> (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y ) n

<span class="keyword">let</span> <span class="keyword">constant</span> <a name="hadamard_634">hadamard</a> : <a href="#circuit_621">circuit</a>
  = {<a href="wired_circuits.html#pre_274">pre</a> = <a href="wired_circuits.html#Hadamard_39">Hadamard</a>}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = 1}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = 1}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = 1}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i = y i}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.  <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  = (x 0 <a href="int.html#infix%20*_20">*</a>y 0)<a href="#infix%20/./_558">/./</a>1 }

<span class="keyword">let</span> <span class="keyword">function</span> <a name="m_skip_642">m_skip</a> (k:int): <a href="#circuit_621">circuit</a>
        <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C_21">&lt;</a>k}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = 0}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = 0}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = k}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i. <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i = x i}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  =  1 <a href="#infix%20/./_558">/./</a> 0}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> k:int. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  =  0 <a href="#infix%20/./_558">/./</a> k}
  = <a href="qbricks.html#m_skip_969">m_skip</a> k

<span class="keyword">let</span> <span class="keyword">function</span> <a name="place_652">place</a> (c:<a href="#circuit_621">circuit</a>) (k n :int)
        <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a>k}
        <span class="keyword">requires</span>{ <a href="wired_circuits.html#width_354">width</a> c<a href="int.html#infix%20+_19">+</a> k <a href="int.html#infix%20%3C=_25">&lt;=</a>n}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#pre_274">pre</a> result = <a href="wired_circuits.html#Place_42">Place</a> (<a href="wired_circuits.html#pre_274">pre</a> c)  k n}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = <a href="wired_circuits.html#size_306">size</a> c}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = n}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = <a href="wired_circuits.html#range_288">range</a> c}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. k<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> k <a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#width_354">width</a> c -&gt;  <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i =  <a href="wired_circuits.html#basis_ket_376">basis_ket</a> c (<span class="keyword">fun</span> j -&gt; x (j<a href="int.html#infix%20+_19">+</a>k)) y (i<a href="int.html#infix%20-_23">-</a>k)}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. i <a href="int.html#infix%20%3C_21">&lt;</a> k -&gt;  <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i = x i}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. k <a href="int.html#infix%20+_19">+</a><a href="wired_circuits.html#width_354">width</a> c <a href="int.html#infix%20%3C=_25">&lt;=</a> i -&gt; <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i =  x i}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  = <a href="wired_circuits.html#ang_ind_432">ang_ind</a> c (<span class="keyword">fun</span> j -&gt; x (j<a href="int.html#infix%20+_19">+</a>k)) y}
  = <a href="wired_circuits.html#place_805">place</a> c k n

<span class="keyword">let</span> <span class="keyword">function</span> (<a name="infix%20--_665">--</a>) ( d e:<a href="#circuit_621">circuit</a>)
        <span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> d = <a href="wired_circuits.html#width_354">width</a> e}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = <a href="wired_circuits.html#size_306">size</a> d <a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#size_306">size</a> e}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = <a href="wired_circuits.html#width_354">width</a> d}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = <a href="wired_circuits.html#range_288">range</a> d <a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#range_288">range</a> e}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.<span class="keyword">forall</span> i:int.
       		       <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i =
       		       <a href="wired_circuits.html#basis_ket_376">basis_ket</a> e (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y) (<span class="keyword">fun</span> k -&gt; y (k<a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#range_288">range</a> d)) i}
       <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  =
                       (<a href="wired_circuits.html#ang_ind_432">ang_ind</a> d x y) <a href="#infix%20+.+_552">+.+</a> (<a href="wired_circuits.html#ang_ind_432">ang_ind</a> e (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y)  (<span class="keyword">fun</span> k -&gt; y (k<a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#range_288">range</a> d)))}
  =  Qbricks_prim.(<a href="wired_circuits.html#infix%20--_837">--</a>) d e

<span class="keyword">let</span> <span class="keyword">function</span> <a name="cnot_677">cnot</a> (co t n:int) : <a href="#circuit_621">circuit</a>
         <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> co<a href="int.html#infix%20%3C_21">&lt;</a>n}
         <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> t<a href="int.html#infix%20%3C_21">&lt;</a>n}
         <span class="keyword">requires</span>{t&lt;&gt;co}
         <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = 1}
         <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = 0}
         <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = n}
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y : int-&gt;int. <span class="keyword">forall</span> i: int.
	 	i &lt;&gt; t -&gt;<a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i =  x i}
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y : int-&gt;int. <span class="keyword">forall</span> i: int.
	 	i = t  -&gt; <a href="#binary_l_497">binary_l</a> x n -&gt; <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i = <a href="#xor_541">xor</a>  (x co) (x t) }
         <span class="keyword">ensures</span>{<span class="keyword">forall</span>  x y. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  = <a href="#ang_zero_554">ang_zero</a>}
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> d: <a href="#circuit_621">circuit</a>. <span class="keyword">forall</span>  x y i.
	 	<a href="wired_circuits.html#width_354">width</a> d = n -&gt; i &lt;&gt; t -&gt; <a href="wired_circuits.html#basis_ket_376">basis_ket</a> (d <a href="#infix%20--_665">--</a> result) x y i =  <a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y i}
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> d: <a href="#circuit_621">circuit</a>. <span class="keyword">forall</span>  x y i.
	 	<a href="#binary_l_497">binary_l</a> x n -&gt;<a href="#binary_l_497">binary_l</a> y (<a href="wired_circuits.html#range_288">range</a> d) -&gt;  <a href="wired_circuits.html#width_354">width</a> d = n -&gt;   i = t  -&gt;
			 <a href="wired_circuits.html#basis_ket_376">basis_ket</a> (d <a href="#infix%20--_665">--</a>result) x y i = <a href="#xor_541">xor</a>  ( <a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y co) ( <a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y t) }
         <span class="keyword">ensures</span>{<span class="keyword">forall</span> d: <a href="#circuit_621">circuit</a>.
	 	<a href="wired_circuits.html#width_354">width</a> d = n -&gt;  <a href="wired_circuits.html#ang_ind_432">ang_ind</a> (d<a href="#infix%20--_665">--</a>result)   = <a href="wired_circuits.html#ang_ind_432">ang_ind</a> d }
  = Qbricks_prim.<a href="wired_circuits.html#cnot_731">cnot</a> co t n

 <span class="keyword">predicate</span> <a name="diag_circ_698">diag_circ</a> (d:<a href="#circuit_621">circuit</a>)
= <span class="keyword">forall</span> x y i. <a href="#basis_ket_622">basis_ket</a> d x y  i = x i
/\ <a href="#range_623">range</a> d = 0

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="get_diag_702">get_diag</a> (d:<a href="#circuit_621">circuit</a>)
    <span class="keyword">requires</span>{<a href="#diag_circ_698">diag_circ</a> d}
    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y i. <a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y  i = x i}
    <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> d = 0}
    =()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="set_diag_708">set_diag</a> (d:<a href="#circuit_621">circuit</a>)
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y i. <a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y  i = x i}
    <span class="keyword">requires</span>{<a href="wired_circuits.html#range_288">range</a> d = 0}
    <span class="keyword">ensures</span>{<a href="#diag_circ_698">diag_circ</a> d}
    =()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="diag_circ_basis_ket_714">diag_circ_basis_ket</a> (d:<a href="#circuit_621">circuit</a>) (x y:int-&gt;int)
    <span class="keyword">requires</span>{<a href="#diag_circ_698">diag_circ</a> d}
    <span class="keyword">ensures</span>{<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y  = x }
    = ()

<span class="keyword">let</span> <span class="keyword">function</span> <a name="seq_diag_719">seq_diag</a> ( d e:<a href="#circuit_621">circuit</a>)
     <span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> d = <a href="wired_circuits.html#width_354">width</a> e}
     <span class="keyword">requires</span>{<a href="#diag_circ_698">diag_circ</a> d}
     <span class="keyword">requires</span>{<a href="#diag_circ_698">diag_circ</a> e}
     <span class="keyword">ensures</span>{result = d <a href="#infix%20--_665">--</a> e}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = <a href="wired_circuits.html#size_306">size</a> d  <a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#size_306">size</a> e}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = <a href="wired_circuits.html#width_354">width</a> d}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = 0}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y =  <a href="wired_circuits.html#ang_ind_432">ang_ind</a> d x y  <a href="#infix%20+.+_552">+.+</a> <a href="wired_circuits.html#ang_ind_432">ang_ind</a> e x y }
     <span class="keyword">ensures</span>{<a href="#diag_circ_698">diag_circ</a> result}
  =
<a href="#get_diag_702">get_diag</a> d;
<a href="#get_diag_702">get_diag</a> e;
<a href="#set_diag_708">set_diag</a> (d <a href="#infix%20--_665">--</a> e);
d <a href="#infix%20--_665">--</a> e

<span class="keyword">let</span> <span class="keyword">function</span> <a name="seq_diag_right_735">seq_diag_right</a> ( d e:<a href="#circuit_621">circuit</a>)
     <span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> d = <a href="wired_circuits.html#width_354">width</a> e}
     <span class="keyword">requires</span>{<a href="#diag_circ_698">diag_circ</a> e}
     <span class="keyword">ensures</span>{result = d <a href="#infix%20--_665">--</a> e}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = <a href="wired_circuits.html#size_306">size</a> d  <a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#size_306">size</a> e}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = <a href="wired_circuits.html#width_354">width</a> d}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = <a href="wired_circuits.html#range_288">range</a> d}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y i. <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i= <a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y i}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.
     	       <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  =
                   (<a href="wired_circuits.html#ang_ind_432">ang_ind</a> d x y) <a href="#infix%20+.+_552">+.+</a> (<a href="wired_circuits.html#ang_ind_432">ang_ind</a> e (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y)  (<span class="keyword">fun</span> k -&gt; y (k<a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#range_288">range</a> d)))}
  = <a href="#get_diag_702">get_diag</a> e;
   d <a href="#infix%20--_665">--</a> e

<span class="keyword">let</span> <span class="keyword">function</span> <a name="seq_diag_left_749">seq_diag_left</a> ( d e:<a href="#circuit_621">circuit</a>)
     <span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> d = <a href="wired_circuits.html#width_354">width</a> e}
     <span class="keyword">requires</span>{<a href="#diag_circ_698">diag_circ</a>  d}
     <span class="keyword">ensures</span>{result = d <a href="#infix%20--_665">--</a> e}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = <a href="wired_circuits.html#size_306">size</a> d  <a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#size_306">size</a> e}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = <a href="wired_circuits.html#width_354">width</a> d}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = <a href="wired_circuits.html#range_288">range</a> e}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i =  <a href="wired_circuits.html#basis_ket_376">basis_ket</a> e x y  i}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  =   (<a href="wired_circuits.html#ang_ind_432">ang_ind</a> d x y) <a href="#infix%20+.+_552">+.+</a> (<a href="wired_circuits.html#ang_ind_432">ang_ind</a> e x  y)}
  = <a href="#get_diag_702">get_diag</a> d;
   d <a href="#infix%20--_665">--</a> e

<span class="keyword">let</span> <span class="keyword">function</span> <a name="crz_761">crz</a> (c t k n:int):<a href="#circuit_621">circuit</a>
      <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> c <a href="int.html#infix%20%3C_21">&lt;</a> n}
      <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> t <a href="int.html#infix%20%3C_21">&lt;</a> n}
      <span class="keyword">requires</span>{c&lt;&gt;t}
      <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = n}
      <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = <a href="wired_circuits.html#cont_size_137">cont_size</a>}
      <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = 0}
      <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y k&#39;. 0<a href="int.html#infix%20%3C=_25">&lt;=</a> k<a href="int.html#infix%20%3C=_25">&lt;=</a> k&#39; -&gt;
      		     <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  = (x c <a href="int.html#infix%20*_20">*</a> x t <a href="int.html#infix%20*_20">*</a><a href="#power_465">power</a> 2 (k&#39;<a href="int.html#infix%20-_23">-</a>k))<a href="#infix%20/./_558">/./</a>k&#39;}
      <span class="comment">(* ensures{forall d x y k&#39;.  width d = n -&gt; 0&lt;= k&lt;= k&#39; -&gt; *)</span>
      <span class="comment">(* 		     ang_ind (d -- result) x y  = *)</span>
      <span class="comment">(* 	       (ang_ind d x y) +.+  ((basis_ket d x y) c * (basis_ket d x y) t *power 2 (k&#39;-k))/./k&#39;} *)</span>
      <span class="keyword">ensures</span>{<a href="#diag_circ_698">diag_circ</a> result}
        =
	<a href="#set_diag_708">set_diag</a>(<a href="qbricks.html#crz_1044">crz</a> c t k n);
	<a href="qbricks.html#crz_1044">crz</a> c t k n

<span class="keyword">predicate</span> <a name="flat_mute_circ_778">flat_mute_circ</a> (d:<a href="#circuit_621">circuit</a>)
 = <span class="keyword">forall</span> x y. <a href="#ang_ind_624">ang_ind</a> d x y  = <a href="#ang_zero_554">ang_zero</a>
/\
<a href="#range_623">range</a> d = 0

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="flat_mute_circ_ang_ind_783">flat_mute_circ_ang_ind</a> (d:<a href="#circuit_621">circuit</a>) (x y:int -&gt; int)
    <span class="keyword">requires</span>{<a href="#flat_mute_circ_778">flat_mute_circ</a> d}
    <span class="keyword">ensures</span>{<a href="wired_circuits.html#ang_ind_432">ang_ind</a> d x y  = <a href="#ang_zero_554">ang_zero</a>}
    =()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="get_flat_mute_788">get_flat_mute</a> (d:<a href="#circuit_621">circuit</a>)
    <span class="keyword">requires</span>{<a href="#flat_mute_circ_778">flat_mute_circ</a> d}
    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y :int-&gt;int. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> d x y   = <a href="#ang_zero_554">ang_zero</a>}
    <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> d = 0}
    =()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="set_flat_mute_794">set_flat_mute</a> (d:<a href="#circuit_621">circuit</a>)
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y  :int-&gt;int. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> d x y   =  <a href="#ang_zero_554">ang_zero</a>}
    <span class="keyword">requires</span>{<a href="wired_circuits.html#range_288">range</a> d = 0}
    <span class="keyword">ensures</span>{<a href="#flat_mute_circ_778">flat_mute_circ</a> d}
    =()

<span class="keyword">let</span> <span class="keyword">function</span> <a name="seq_flat_mute_800">seq_flat_mute</a> ( d e:<a href="#circuit_621">circuit</a>)
     <span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> d = <a href="wired_circuits.html#width_354">width</a> e}
     <span class="keyword">requires</span>{<a href="#flat_mute_circ_778">flat_mute_circ</a> d}
     <span class="keyword">requires</span>{<a href="#flat_mute_circ_778">flat_mute_circ</a> e}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = <a href="wired_circuits.html#width_354">width</a> d}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="#binary_l_497">binary_l</a>  x (<a href="wired_circuits.html#width_354">width</a> d) -&gt; 0<a href="int.html#infix%20%3C=_25">&lt;=</a>i <a href="int.html#infix%20%3C_21">&lt;</a> <a href="wired_circuits.html#width_354">width</a> d -&gt;
	       		      <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i =  <a href="wired_circuits.html#basis_ket_376">basis_ket</a> e (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y) y i}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = <a href="wired_circuits.html#width_354">width</a> d}
     <span class="keyword">ensures</span>{<a href="#flat_mute_circ_778">flat_mute_circ</a> result}
  = <a href="#get_flat_mute_788">get_flat_mute</a> d;
  <a href="#get_flat_mute_788">get_flat_mute</a> e;
  <a href="#set_flat_mute_794">set_flat_mute</a> (d <a href="#infix%20--_665">--</a> e);
  d<a href="#infix%20--_665">--</a>e

<span class="keyword">let</span> <span class="keyword">function</span> <a name="seq_flat_mute_right_814">seq_flat_mute_right</a> ( d e:<a href="#circuit_621">circuit</a>)
     <span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> d = <a href="wired_circuits.html#width_354">width</a> e}
     <span class="keyword">requires</span>{<a href="#flat_mute_circ_778">flat_mute_circ</a> e}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = <a href="wired_circuits.html#size_306">size</a> d  <a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#size_306">size</a> e}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = <a href="wired_circuits.html#width_354">width</a> d}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = <a href="wired_circuits.html#range_288">range</a> d}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="#binary_l_497">binary_l</a>  x (<a href="wired_circuits.html#width_354">width</a> d) -&gt; <a href="#binary_l_497">binary_l</a>  y (<a href="wired_circuits.html#range_288">range</a>  d) -&gt;
     0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> <a href="wired_circuits.html#width_354">width</a> d -&gt;<a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i = <a href="wired_circuits.html#basis_ket_376">basis_ket</a> e (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y)  (<span class="keyword">fun</span> k -&gt; y (k <a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#range_288">range</a> d)) i}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.  <a href="#binary_l_497">binary_l</a>  x (<a href="wired_circuits.html#width_354">width</a> d) -&gt; <a href="#binary_l_497">binary_l</a>  y (<a href="wired_circuits.html#range_288">range</a>  d) -&gt; <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  =
                                                                                                   (<a href="wired_circuits.html#ang_ind_432">ang_ind</a> d x y)}
  =  <a href="#get_flat_mute_788">get_flat_mute</a> e;
  d <a href="#infix%20--_665">--</a> e

<span class="keyword">let</span> <span class="keyword">function</span> <a name="seq_flat_mute_left_827">seq_flat_mute_left</a> ( d e:<a href="#circuit_621">circuit</a>)
               <span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> d = <a href="wired_circuits.html#width_354">width</a> e}
	       <span class="keyword">requires</span>{<a href="#flat_mute_circ_778">flat_mute_circ</a> d}
               <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = <a href="wired_circuits.html#size_306">size</a> d  <a href="int.html#infix%20+_19">+</a> <a href="wired_circuits.html#size_306">size</a> e}
               <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = <a href="wired_circuits.html#width_354">width</a> d}
               <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = <a href="wired_circuits.html#range_288">range</a> e}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int. <a href="#binary_l_497">binary_l</a>  x (<a href="wired_circuits.html#width_354">width</a> d) -&gt; <a href="#binary_l_497">binary_l</a>  y (<a href="wired_circuits.html#range_288">range</a>  e) -&gt;0<a href="int.html#infix%20%3C=_25">&lt;=</a> i <a href="int.html#infix%20%3C_21">&lt;</a> <a href="wired_circuits.html#width_354">width</a> d -&gt; <a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i =
                                                                                                                                  <a href="wired_circuits.html#basis_ket_376">basis_ket</a> e (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y) y i}
               <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <a href="#binary_l_497">binary_l</a>  x (<a href="wired_circuits.html#width_354">width</a> d) -&gt;<a href="#binary_l_497">binary_l</a>  y (<a href="wired_circuits.html#range_288">range</a>  e) -&gt;<a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  =
                                                                                                <a href="wired_circuits.html#ang_ind_432">ang_ind</a> e (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> d x y)  y}
  = <a href="#get_flat_mute_788">get_flat_mute</a> d;
  d <a href="#infix%20--_665">--</a> e

<span class="keyword">let</span> <span class="keyword">function</span> <a name="rm_skip_840">rm_skip</a> (k:int): <a href="#circuit_621">circuit</a>
        <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C_21">&lt;</a>k}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result = 0}
	<span class="keyword">ensures</span>{<a href="#diag_circ_698">diag_circ</a> result}
	<span class="keyword">ensures</span>{<a href="#flat_mute_circ_778">flat_mute_circ</a> result}
        <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = k}
  = <a href="#get_flat_mute_788">get_flat_mute</a> (<a href="#m_skip_642">m_skip</a> k);
    <a href="#get_diag_702">get_diag</a> (<a href="#m_skip_642">m_skip</a> k);
    <a href="#m_skip_642">m_skip</a> k

<span class="keyword">let</span> <span class="keyword">function</span> <a name="place_hadamard_850">place_hadamard</a>   (k n:int)  : <a href="#circuit_621">circuit</a>
     <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C=_25">&lt;=</a> k <a href="int.html#infix%20%3C_21">&lt;</a>n}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#range_288">range</a> result = 1}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#width_354">width</a> result = n}
     <span class="keyword">ensures</span>{<a href="wired_circuits.html#size_306">size</a> result =1}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> i:int.
     		    0<a href="int.html#infix%20%3C=_25">&lt;=</a>i<a href="int.html#infix%20%3C_21">&lt;</a>n -&gt;<a href="wired_circuits.html#basis_ket_376">basis_ket</a> result x y i = <span class="keyword">if</span> i = k <span class="keyword">then</span> y 0 <span class="keyword">else</span> x i}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int.
     		    <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  =  (x k <a href="int.html#infix%20*_20">*</a> y 0) <a href="#infix%20/./_558">/./</a> 1}
     <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y: int-&gt;int. <span class="keyword">forall</span> m:int.
     		    1<a href="int.html#infix%20%3C=_25">&lt;=</a> m -&gt;  <a href="wired_circuits.html#ang_ind_432">ang_ind</a> result x y  = (x k <a href="int.html#infix%20*_20">*</a> y 0<a href="int.html#infix%20*_20">*</a><a href="#power_465">power</a> 2 (m<a href="int.html#infix%20-_23">-</a>1)) <a href="#infix%20/./_558">/./</a> m }
  = <a href="qbricks.html#place_hadamard_778">place_hadamard</a>  k n

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ang_sum_comp_re_diag_863">ang_sum_comp_re_diag</a> (f:(int-&gt;int) -&gt;  int -&gt;int -&gt; <a href="#angle_551">angle</a>) (c d:<a href="#circuit_621">circuit</a>) (q i j:int)
<span class="keyword">requires</span>{i<a href="int.html#infix%20%3C=_25">&lt;=</a>j}
<span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> c = <a href="wired_circuits.html#width_354">width</a> d}
    <span class="keyword">requires</span>{<a href="#diag_circ_698">diag_circ</a> c}
    <span class="keyword">requires</span>{<a href="#diag_circ_698">diag_circ</a> d}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> c x y = <a href="#ang_sum_587">ang_sum</a> (f x q) i j}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y.  <a href="wired_circuits.html#ang_ind_432">ang_ind</a> d x y   = f x  q j}
    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> (<a href="#seq_diag_719">seq_diag</a> c d) x y = <a href="#ang_sum_587">ang_sum</a> (f x q) i (j<a href="int.html#infix%20+_19">+</a>1)}
   =()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ang_sum_comp_plus_one_873">ang_sum_comp_plus_one</a> (f:(int-&gt;int) -&gt; (int-&gt;int) -&gt;  int  -&gt; int  -&gt; <a href="#angle_551">angle</a>) (c d:<a href="#circuit_621">circuit</a>) (q i j:int)
<span class="keyword">requires</span>{i<a href="int.html#infix%20%3C_21">&lt;</a>j}
<span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> c = <a href="wired_circuits.html#width_354">width</a> d}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y.  <a href="wired_circuits.html#ang_ind_432">ang_ind</a> c x y   = f x y q i}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> d (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> c x y) (<span class="keyword">fun</span> i  -&gt; y(i<a href="int.html#infix%20+_19">+</a><a href="wired_circuits.html#range_288">range</a> c)) = <a href="#ang_sum_587">ang_sum</a> (f x y q) (i<a href="int.html#infix%20+_19">+</a>1) j}
    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> (c <a href="#infix%20--_665">--</a> d) x y = <a href="#ang_sum_587">ang_sum</a> (f x y q) i j}
   =()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="ang_sum_comp_re_881">ang_sum_comp_re</a> (f:(int-&gt;int) -&gt; (int-&gt;int) -&gt;  int  -&gt; int  -&gt; <a href="#angle_551">angle</a>) (c d:<a href="#circuit_621">circuit</a>) (q i j:int)
<span class="keyword">requires</span>{i<a href="int.html#infix%20%3C_21">&lt;</a>j}
<span class="keyword">requires</span>{<a href="wired_circuits.html#width_354">width</a> c = <a href="wired_circuits.html#width_354">width</a> d}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y.  <a href="wired_circuits.html#ang_ind_432">ang_ind</a> c x y   =  <a href="#ang_sum_587">ang_sum</a> (f x y q) i (j<a href="int.html#infix%20-_23">-</a>1)}
    <span class="keyword">requires</span>{<span class="keyword">forall</span> x y. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> d (<a href="wired_circuits.html#basis_ket_376">basis_ket</a> c x y) (<span class="keyword">fun</span> i  -&gt; y(i<a href="int.html#infix%20+_19">+</a><a href="wired_circuits.html#range_288">range</a> c)) = f x y q (j<a href="int.html#infix%20-_23">-</a>1)}
    <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="wired_circuits.html#ang_ind_432">ang_ind</a> (c <a href="#infix%20--_665">--</a> d) x y = <a href="#ang_sum_587">ang_sum</a> (f x y q) i j}
   =()

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="int_to_ang_by_sum_mult_break_889">int_to_ang_by_sum_mult_break</a>(n:int) (x y: <a href="#bitvec_495">bitvec</a>)
      <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C_21">&lt;</a>n}
      <span class="keyword">requires</span>{<a href="binary.html#length_222">length</a> x = n}
      <span class="keyword">requires</span>{<a href="binary.html#length_222">length</a> y = n}
      <span class="keyword">ensures</span>{ (<a href="#ind_isum_468">ind_isum</a> (<span class="keyword">fun</span> j -&gt; <a href="#ind_isum_468">ind_isum</a> (<span class="keyword">fun</span> i -&gt;  <a href="binary.html#getbv_237">getbv</a> x i <a href="int.html#infix%20*_20">*</a> <a href="binary.html#getbv_237">getbv</a> y j <a href="int.html#infix%20*_20">*</a> <a href="#power_465">power</a> 2 (n<a href="int.html#infix%20-_23">-</a>i<a href="int.html#infix%20-_23">-</a>1<a href="int.html#infix%20+_19">+</a>j)) j n) 0 n) <a href="#infix%20/./_558">/./</a>n
               =  (<a href="#bv_to_int_536">bv_to_int</a> x <a href="int.html#infix%20*_20">*</a> <a href="#bv_to_int_536">bv_to_int</a> (<a href="#bv_inversion_531">bv_inversion</a> y)) <a href="#infix%20/./_558">/./</a>n}
  = <a href="unit_circle.html#int_to_ang_by_sum_mult_break_1534">int_to_ang_by_sum_mult_break</a> n x y

<span class="keyword">let</span> <span class="keyword">lemma</span> <a name="phase_binary_prod_decomp_897">phase_binary_prod_decomp</a> (n :int)
        <span class="keyword">requires</span>{0<a href="int.html#infix%20%3C_21">&lt;</a>n}
        <span class="keyword">ensures</span>{<span class="keyword">forall</span> x y. <a href="#binary_l_497">binary_l</a> x n -&gt; <a href="#binary_l_497">binary_l</a> y n -&gt;(<a href="#ind_isum_468">ind_isum</a> (<span class="keyword">fun</span> j -&gt; <a href="#ind_isum_468">ind_isum</a> (<span class="keyword">fun</span> i -&gt;   x i <a href="int.html#infix%20*_20">*</a>  y j <a href="int.html#infix%20*_20">*</a> <a href="#power_465">power</a> 2 (n<a href="int.html#infix%20-_23">-</a>i<a href="int.html#infix%20-_23">-</a>1<a href="int.html#infix%20+_19">+</a>j)) j n) 0 n) <a href="#infix%20/./_558">/./</a>n
               =  (<a href="#bv_to_int_536">bv_to_int</a> (<a href="#make_bv_523">make_bv</a> x n) <a href="int.html#infix%20*_20">*</a> <a href="#bv_to_int_536">bv_to_int</a> (<a href="#bv_inversion_531">bv_inversion</a> (<a href="#make_bv_523">make_bv</a> y n))) <a href="#infix%20/./_558">/./</a>n}
  = ()

<span class="keyword">end</span>
</pre>

</div>
<hr>
<p>Generated by why3doc 1.8.0</p>
</body>
</html>
